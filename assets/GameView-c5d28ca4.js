var xt=Object.defineProperty;var mt=(i,t,r)=>t in i?xt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[t]=r;var d=(i,t,r)=>(mt(i,typeof t!="symbol"?t+"":t,r),r);import{D as yt,f as bt,i as _t,j as St,h as st}from"./VCard-accb43b0.js";import{R as ht,U as Mt,r as Pt,C as Et,aj as at,ak as It,E as qt,V as rt,e as L,Y as pt,al as kt,am as jt,an as Ct,W as Tt,X as $,ao as Dt,c as G,Z as V,ap as ct,z as H,_ as zt}from"./index-9c23af97.js";class At{constructor(){d(this,"res");this.res=null}async enter(){return this.res?(await new Promise(t=>{var r;(r=this.res)==null||r.push(t)}),!1):(this.res=[],!0)}leave(){this.res&&(this.res.length>0?this.res.shift()():this.res=null)}}class it{constructor(){d(this,"section");d(this,"items");d(this,"resolves");this.section=new At,this.items=[],this.resolves=[]}push(t,r=!0){const n=this.resolves.shift();n?this.section.enter().then(o=>{o&&r?setTimeout(()=>{n(t),this.section.leave()},0):(n(t),this.section.leave())}):this.items.push(t)}async pop(){return this.items.length>0?this.items.shift():new Promise(t=>{this.resolves.push(t)})}}class F{constructor(){d(this,"slots");this.slots=[]}connect(t){this.slots.push(t)}disconnect(t){t?this.slots=this.slots.filter(r=>r===t):this.slots=[]}async emit(t,r=!1){if(r)await Promise.all(this.slots.map(n=>n.exec(t)));else for(const n of this.slots)await n.exec(t)}}class N{constructor(){d(this,"action");this.action=[]}async exec(t){for(const r of this.action)await r(t)}bind(t){this.action.push(t)}}class vt{constructor(t=!1){d(this,"signal");d(this,"slot");this.signal=new F,this.slot=new N,this.slot.bind(async r=>{await this.signal.emit(r,t)})}}class Bt{constructor(t){d(this,"game");this.game=t}async exec(t){for(;!t();){const r=await this.game.queue.pop();await this.game.game.mainBroadcast.slot.exec(r)}}}class Ot{constructor(t){d(this,"game");d(this,"loop");d(this,"queue");d(this,"mainSlot");d(this,"clientBroadcast");this.game=t(this),this.loop=new Bt(this),this.queue=new it,this.mainSlot=new N,this.mainSlot.bind(async r=>{this.queue.push(r)}),this.clientBroadcast=new vt}async poll(t=()=>!1){await this.loop.exec(t)}bind(t){const r=t(this);return this.game.clientSignal.connect(r.clientSlot),r.clientSignal.connect(this.clientBroadcast.slot),r}getClientConnection(){return{signal:this.clientBroadcast.signal,slot:this.mainSlot}}}class $t{constructor(t){d(this,"connections");d(this,"queue");const r=new N;r.bind(async n=>{this.queue.push(n)}),this.connections=t,this.queue=new it,t.forEach(n=>{n.signal.connect(r)})}async poll(t=()=>!1){const r=new F;for(this.connections.forEach(n=>{r.connect(n.slot)});!t();){const n=await this.queue.pop();await r.emit(n,!0)}}}var B=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gt(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var r=function n(){if(this instanceof n){var o=[null];o.push.apply(o,arguments);var a=Function.bind.apply(t,o);return new a}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var o=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(r,n,o.get?o:{enumerable:!0,get:function(){return i[n]}})}),r}const Ft={class:"ma-auto"},Nt=ht({__name:"ChessGame",props:{client:null},setup(i){const t=i,r=Mt(),n=Math.floor((document.body.clientWidth-5)/10-1)*10,o=Pt(null),a=new at;Et(()=>{var _;const v=(_=o.value)==null?void 0:_.getContext("2d");setInterval(h(v),1e3/20),a.push({x:20,y:30}),a.push({x:50,y:70}),a.push({x:100,y:0})});const p=[[0,1,60,110],[0,0,110,80],[0,1,160,30],[0,0,330,140],[0,0,330,220],[0,1,160,330],[0,0,110,280],[0,1,60,250],[0,0,30,180],[1,3,230,50],[1,2,270,130],[1,1,270,230],[1,0,230,310],[2,0,60,180],[2,0,80,180],[2,0,100,180],[2,0,120,180],[2,0,140,180]],u=[[15,105],[38,118],[60,110],[80,110],[102,118],[118,102],[110,80],[110,60],[118,38],[140,30],[160,30],[180,30],[200,30],[220,30],[242,38],[250,60],[250,80],[242,102],[258,118],[280,110],[300,110],[322,118],[330,140],[330,160],[330,180],[330,200],[330,220],[322,242],[300,250],[280,250],[258,242],[242,258],[250,280],[250,300],[242,322],[220,330],[200,330],[180,330],[160,330],[140,330],[118,322],[110,300],[110,280],[118,258],[102,242],[80,250],[60,250],[38,242],[30,220],[30,200],[30,180],[60,180],[80,180],[100,180],[120,180],[140,180],[160,180]],e=[[40,40],[40,60],[60,40],[60,60]],c=["#FF3F3F","#CFCF00","#00CFFF","#00CF00"];function f(v,_){const[x,q]=_;switch(v){case 0:return[x,q];case 1:return[360-q,x];case 2:return[360-x,360-q];case 3:return[q,360-x]}}function s(v,_,x){return x>=0?f(v,u[x]):f(v,e[_])}const l=[];function h(v){const _=new Path2D;_.rect(0,0,360,360);const x=new Path2D;x.ellipse(0,0,8,8,0,0,Math.PI*2);const q=new Path2D;q.rect(-20,-10,40,20);const D=new Path2D("M 0 0 L 40 0 L 0 40 z"),w=new Path2D;w.rect(-10,-10,20,20);const b=[q,D,w],I=new Path2D("M -2 -10 L 2 -10 L 2 0 L 4 0 L 0 10 L -4 0 L -2 0 z"),M=new Path2D;M.rect(20,20,60,60);const P=new Path2D("M 150 150 L 180 180 L 150 210 z"),k=y=>{v.translate(180,180),v.rotate(y*Math.PI/180),v.translate(-180,-180)},j=y=>{v.save(),y(),v.restore()},S=(y,m)=>{j(()=>{m.translate&&v.translate(m.translate.x,m.translate.y),m.rotate&&v.rotate(m.rotate*Math.PI/180),m.fill&&(v.fillStyle=m.fill,v.fill(y)),m.stroke&&(v.strokeStyle=m.stroke,v.stroke(y))})},C=t.client.slave.game.data;for(let y=0;y<4;y++)for(let m=0;m<4;m++){const z=s(y,m,C.chess[y][m]),E=new at({x:z[0],y:z[1]});It(E),qt(()=>C.chess[y][m],A=>{const X=s(y,m,A);E.push({x:X[0],y:X[1]})}),l.push(rt({pos:E,player:y,chess:m,place:L(()=>C.chess[y][m])}))}return k(-90),()=>{S(_,{fill:"wheat"});for(const[y,m]of c.entries()){j(()=>{k(y*90);for(const E of p)S(b[E[0]],{translate:{x:E[2],y:E[3]},rotate:E[1]*90,fill:m,stroke:"black"});S(x,{translate:{x:15,y:105},fill:"white",stroke:"black"}),S(M,{fill:m,stroke:t.client.data.current===y?"yellow":"black"}),S(x,{translate:{x:40,y:40},fill:"white",stroke:"black"}),S(x,{translate:{x:40,y:60},fill:"white",stroke:"black"}),S(x,{translate:{x:60,y:40},fill:"white",stroke:"black"}),S(x,{translate:{x:60,y:60},fill:"white",stroke:"black"}),S(P,{fill:m,stroke:"black"}),S(I,{translate:{x:260,y:150},fill:m,stroke:"black"}),S(I,{translate:{x:260,y:210},fill:m,stroke:"black"})});const z=new Set;l.forEach(E=>{j(()=>{const A=E.pos.get();if(!E.pos.moving){for(;z.has(`${A.x},${A.y}`);)A.x+=2,A.y+=3;z.add(`${A.x},${A.y}`)}const{x:X,y:wt}=A;v.translate(X,wt),v.fillStyle="white",v.fill(x),v.stroke(x),v.fillStyle=c[E.player],v.beginPath(),v.ellipse(0,0,5,5,0,0,Math.PI*2),v.closePath(),v.fill()})}),v.font="16pt consolas",j(()=>{const E=f((t.client.data.current+3)%4,[10,10]);k(90),v.fillStyle="red",v.fillText(t.client.data.roll.toString(),E[0]-5,E[1]+5)})}}}function g(v){let _=-1;for(let x=0;x<4;x++){const q=s(3,x,t.client.slave.game.data.chess[0][x]),D=v.offsetX*360/n-q[0],w=v.offsetY*360/n-q[1];if(D*D+w*w<144){_=x;break}}_!==-1&&t.client.choose(_)}return t.client.clientSlot.bind(async v=>{v.msg==="end"&&!t.client.slave.game.data.fin[0]&&await Promise.all(l.map(_=>_.pos.wait()).concat([new Promise(_=>setTimeout(_,r.actionSpeed))]))}),(v,_)=>(pt(),kt("div",Ft,[jt("canvas",{ref_key:"canvasEl",ref:o,style:Ct({width:`${n}px`,height:`${n}px`}),width:"360",height:"360",onClick:g},null,4)]))}});class U{async eval(t,r){const n=r(0);if(t===6){for(let a=0;a<4;a++)if(n[a]===-1)return a}const o=[];for(let a=0;a<4;a++){const p=n[a];p===56||p===-1||o.push(a)}for(const a of o)if(n[a]+t===56)return a;for(const a of o)if(n[a]+t===14||n[a]+t===18)return a;for(const a of o)if(n[a]+t<=46&&(n[a]+t)%4===2)return a;for(const a of o)if(n[a]+t<56)return a;return o[0]||0}}var Y={},Xt={get exports(){return Y},set exports(i){Y=i}};(function(i){(function(t,r,n){function o(e){var c=this,f=u();c.next=function(){var s=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=s-(c.c=s|0)},c.c=1,c.s0=f(" "),c.s1=f(" "),c.s2=f(" "),c.s0-=f(e),c.s0<0&&(c.s0+=1),c.s1-=f(e),c.s1<0&&(c.s1+=1),c.s2-=f(e),c.s2<0&&(c.s2+=1),f=null}function a(e,c){return c.c=e.c,c.s0=e.s0,c.s1=e.s1,c.s2=e.s2,c}function p(e,c){var f=new o(e),s=c&&c.state,l=f.next;return l.int32=function(){return f.next()*4294967296|0},l.double=function(){return l()+(l()*2097152|0)*11102230246251565e-32},l.quick=l,s&&(typeof s=="object"&&a(s,f),l.state=function(){return a(f,{})}),l}function u(){var e=4022871197,c=function(f){f=String(f);for(var s=0;s<f.length;s++){e+=f.charCodeAt(s);var l=.02519603282416938*e;e=l>>>0,l-=e,l*=e,e=l>>>0,l-=e,e+=l*4294967296}return(e>>>0)*23283064365386963e-26};return c}r&&r.exports?r.exports=p:n&&n.amd?n(function(){return p}):this.alea=p})(B,i,!1)})(Xt);var K={},Lt={get exports(){return K},set exports(i){K=i}};(function(i){(function(t,r,n){function o(u){var e=this,c="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var s=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^s^s>>>8},u===(u|0)?e.x=u:c+=u;for(var f=0;f<c.length+64;f++)e.x^=c.charCodeAt(f)|0,e.next()}function a(u,e){return e.x=u.x,e.y=u.y,e.z=u.z,e.w=u.w,e}function p(u,e){var c=new o(u),f=e&&e.state,s=function(){return(c.next()>>>0)/4294967296};return s.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},s.int32=c.next,s.quick=s,f&&(typeof f=="object"&&a(f,c),s.state=function(){return a(c,{})}),s}r&&r.exports?r.exports=p:n&&n.amd?n(function(){return p}):this.xor128=p})(B,i,!1)})(Lt);var Q={},Rt={get exports(){return Q},set exports(i){Q=i}};(function(i){(function(t,r,n){function o(u){var e=this,c="";e.next=function(){var s=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^(s^s<<1))|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,u===(u|0)?e.x=u:c+=u;for(var f=0;f<c.length+64;f++)e.x^=c.charCodeAt(f)|0,f==c.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function a(u,e){return e.x=u.x,e.y=u.y,e.z=u.z,e.w=u.w,e.v=u.v,e.d=u.d,e}function p(u,e){var c=new o(u),f=e&&e.state,s=function(){return(c.next()>>>0)/4294967296};return s.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},s.int32=c.next,s.quick=s,f&&(typeof f=="object"&&a(f,c),s.state=function(){return a(c,{})}),s}r&&r.exports?r.exports=p:n&&n.amd?n(function(){return p}):this.xorwow=p})(B,i,!1)})(Rt);var Z={},Vt={get exports(){return Z},set exports(i){Z=i}};(function(i){(function(t,r,n){function o(u){var e=this;e.next=function(){var f=e.x,s=e.i,l,h;return l=f[s],l^=l>>>7,h=l^l<<24,l=f[s+1&7],h^=l^l>>>10,l=f[s+3&7],h^=l^l>>>3,l=f[s+4&7],h^=l^l<<7,l=f[s+7&7],l=l^l<<13,h^=l^l<<9,f[s]=h,e.i=s+1&7,h};function c(f,s){var l,h=[];if(s===(s|0))h[0]=s;else for(s=""+s,l=0;l<s.length;++l)h[l&7]=h[l&7]<<15^s.charCodeAt(l)+h[l+1&7]<<13;for(;h.length<8;)h.push(0);for(l=0;l<8&&h[l]===0;++l);for(l==8?h[7]=-1:h[l],f.x=h,f.i=0,l=256;l>0;--l)f.next()}c(e,u)}function a(u,e){return e.x=u.x.slice(),e.i=u.i,e}function p(u,e){u==null&&(u=+new Date);var c=new o(u),f=e&&e.state,s=function(){return(c.next()>>>0)/4294967296};return s.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},s.int32=c.next,s.quick=s,f&&(f.x&&a(f,c),s.state=function(){return a(c,{})}),s}r&&r.exports?r.exports=p:n&&n.amd?n(function(){return p}):this.xorshift7=p})(B,i,!1)})(Vt);var J={},Ht={get exports(){return J},set exports(i){J=i}};(function(i){(function(t,r,n){function o(u){var e=this;e.next=function(){var f=e.w,s=e.X,l=e.i,h,g;return e.w=f=f+1640531527|0,g=s[l+34&127],h=s[l=l+1&127],g^=g<<13,h^=h<<17,g^=g>>>15,h^=h>>>12,g=s[l]=g^h,e.i=l,g+(f^f>>>16)|0};function c(f,s){var l,h,g,v,_,x=[],q=128;for(s===(s|0)?(h=s,s=null):(s=s+"\0",h=0,q=Math.max(q,s.length)),g=0,v=-32;v<q;++v)s&&(h^=s.charCodeAt((v+32)%s.length)),v===0&&(_=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,v>=0&&(_=_+1640531527|0,l=x[v&127]^=h+_,g=l==0?g+1:0);for(g>=128&&(x[(s&&s.length||0)&127]=-1),g=127,v=4*128;v>0;--v)h=x[g+34&127],l=x[g=g+1&127],h^=h<<13,l^=l<<17,h^=h>>>15,l^=l>>>12,x[g]=h^l;f.w=_,f.X=x,f.i=g}c(e,u)}function a(u,e){return e.i=u.i,e.w=u.w,e.X=u.X.slice(),e}function p(u,e){u==null&&(u=+new Date);var c=new o(u),f=e&&e.state,s=function(){return(c.next()>>>0)/4294967296};return s.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},s.int32=c.next,s.quick=s,f&&(f.X&&a(f,c),s.state=function(){return a(c,{})}),s}r&&r.exports?r.exports=p:n&&n.amd?n(function(){return p}):this.xor4096=p})(B,i,!1)})(Ht);var tt={},Ut={get exports(){return tt},set exports(i){tt=i}};(function(i){(function(t,r,n){function o(u){var e=this,c="";e.next=function(){var s=e.b,l=e.c,h=e.d,g=e.a;return s=s<<25^s>>>7^l,l=l-h|0,h=h<<24^h>>>8^g,g=g-s|0,e.b=s=s<<20^s>>>12^l,e.c=l=l-h|0,e.d=h<<16^l>>>16^g,e.a=g-s|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,u===Math.floor(u)?(e.a=u/4294967296|0,e.b=u|0):c+=u;for(var f=0;f<c.length+20;f++)e.b^=c.charCodeAt(f)|0,e.next()}function a(u,e){return e.a=u.a,e.b=u.b,e.c=u.c,e.d=u.d,e}function p(u,e){var c=new o(u),f=e&&e.state,s=function(){return(c.next()>>>0)/4294967296};return s.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},s.int32=c.next,s.quick=s,f&&(typeof f=="object"&&a(f,c),s.state=function(){return a(c,{})}),s}r&&r.exports?r.exports=p:n&&n.amd?n(function(){return p}):this.tychei=p})(B,i,!1)})(Ut);var et={},Wt={get exports(){return et},set exports(i){et=i}};const Yt={},Kt=Object.freeze(Object.defineProperty({__proto__:null,default:Yt},Symbol.toStringTag,{value:"Module"})),Qt=Gt(Kt);(function(i){(function(t,r,n){var o=256,a=6,p=52,u="random",e=n.pow(o,a),c=n.pow(2,p),f=c*2,s=o-1,l;function h(w,b,I){var M=[];b=b==!0?{entropy:!0}:b||{};var P=x(_(b.entropy?[w,D(r)]:w??q(),3),M),k=new g(M),j=function(){for(var S=k.g(a),C=e,y=0;S<c;)S=(S+y)*o,C*=o,y=k.g(1);for(;S>=f;)S/=2,C/=2,y>>>=1;return(S+y)/C};return j.int32=function(){return k.g(4)|0},j.quick=function(){return k.g(4)/4294967296},j.double=j,x(D(k.S),r),(b.pass||I||function(S,C,y,m){return m&&(m.S&&v(m,k),S.state=function(){return v(k,{})}),y?(n[u]=S,C):S})(j,P,"global"in b?b.global:this==n,b.state)}function g(w){var b,I=w.length,M=this,P=0,k=M.i=M.j=0,j=M.S=[];for(I||(w=[I++]);P<o;)j[P]=P++;for(P=0;P<o;P++)j[P]=j[k=s&k+w[P%I]+(b=j[P])],j[k]=b;(M.g=function(S){for(var C,y=0,m=M.i,z=M.j,E=M.S;S--;)C=E[m=s&m+1],y=y*o+E[s&(E[m]=E[z=s&z+C])+(E[z]=C)];return M.i=m,M.j=z,y})(o)}function v(w,b){return b.i=w.i,b.j=w.j,b.S=w.S.slice(),b}function _(w,b){var I=[],M=typeof w,P;if(b&&M=="object")for(P in w)try{I.push(_(w[P],b-1))}catch{}return I.length?I:M=="string"?w:w+"\0"}function x(w,b){for(var I=w+"",M,P=0;P<I.length;)b[s&P]=s&(M^=b[s&P]*19)+I.charCodeAt(P++);return D(b)}function q(){try{var w;return l&&(w=l.randomBytes)?w=w(o):(w=new Uint8Array(o),(t.crypto||t.msCrypto).getRandomValues(w)),D(w)}catch{var b=t.navigator,I=b&&b.plugins;return[+new Date,t,I,t.screen,D(r)]}}function D(w){return String.fromCharCode.apply(0,w)}if(x(n.random(),r),i.exports){i.exports=h;try{l=Qt}catch{}}else n["seed"+u]=h})(typeof self<"u"?self:B,[],Math)})(Wt);var Zt=Y,Jt=K,te=Q,ee=Z,ne=J,re=tt,O=et;O.alea=Zt;O.xor128=Jt;O.xorwow=te;O.xorshift7=ee;O.xor4096=ne;O.tychei=re;var ie=O;function ut(i,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,se(n.key),n)}}function ot(i,t,r){return t&&ut(i.prototype,t),r&&ut(i,r),Object.defineProperty(i,"prototype",{writable:!1}),i}function gt(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i,nt(i,t)}function nt(i,t){return nt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},nt(i,t)}function oe(i,t){if(typeof i!="object"||i===null)return i;var r=i[Symbol.toPrimitive];if(r!==void 0){var n=r.call(i,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(i)}function se(i){var t=oe(i,"string");return typeof t=="symbol"?t:String(t)}var R=function(){function i(){}var t=i.prototype;return t._seed=function(n,o){if(n===(n||0))return n;for(var a=""+n,p=0,u=0;u<a.length;++u)p^=a.charCodeAt(u)|0;return p},i}(),lt=function(i){gt(t,i);function t(n,o){var a;return a=i.call(this)||this,a._rng=void 0,a.seed(n,o),a}var r=t.prototype;return r.next=function(){return this._rng()},r.seed=function(o,a){this._rng=o},r.clone=function(o,a){return new t(this._rng,a)},ot(t,[{key:"name",get:function(){return"function"}}]),t}(R),ft=function(){var i=[].slice.call(arguments),t=i,r=t[0],n=r===void 0?"default":r;switch(typeof n){case"object":if(n instanceof R)return n;break;case"function":return new lt(n);case"number":case"string":default:return new lt(ie.apply(void 0,i))}throw new Error('invalid RNG "'+n+'"')},ae=function(i,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),function(){return i.next()*(r-t)+t}};function T(i){return new ce(i)}var ce=function(t){var r=this;this.n=void 0,this.isInt=function(){if(Number.isInteger(r.n))return r;throw new Error("Expected number to be an integer, got "+r.n)},this.isPositive=function(){if(r.n>0)return r;throw new Error("Expected number to be positive, got "+r.n)},this.lessThan=function(n){if(r.n<n)return r;throw new Error("Expected number to be less than "+n+", got "+r.n)},this.greaterThanOrEqual=function(n){if(r.n>=n)return r;throw new Error("Expected number to be greater than or equal to "+n+", got "+r.n)},this.greaterThan=function(n){if(r.n>n)return r;throw new Error("Expected number to be greater than "+n+", got "+r.n)},this.n=t},ue=function(i,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),r===void 0&&(r=t===void 0?1:t,t=0),T(t).isInt(),T(r).isInt(),function(){return Math.floor(i.next()*(r-t+1)+t)}},le=function(i){return function(){return i.next()>=.5}},fe=function(i,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),function(){var n,o,a;do n=i.next()*2-1,o=i.next()*2-1,a=n*n+o*o;while(!a||a>1);return t+r*o*Math.sqrt(-2*Math.log(a)/a)}},he=function(i,t,r){t===void 0&&(t=0),r===void 0&&(r=1);var n=i.normal(t,r);return function(){return Math.exp(n())}},pe=function(i,t){return t===void 0&&(t=.5),T(t).greaterThanOrEqual(0).lessThan(1),function(){return Math.floor(i.next()+t)}},ve=function(i,t,r){return t===void 0&&(t=1),r===void 0&&(r=.5),T(t).isInt().isPositive(),T(r).greaterThanOrEqual(0).lessThan(1),function(){for(var n=0,o=0;n++<t;)i.next()<r&&o++;return o}},ge=function(i,t){t===void 0&&(t=.5),T(t).greaterThan(0).lessThan(1);var r=1/Math.log(1-t);return function(){return Math.floor(1+Math.log(i.next())*r)}},de=[0,0,.6931471805599453,1.791759469228055,3.1780538303479458,4.787491742782046,6.579251212010101,8.525161361065415,10.60460290274525,12.801827480081469],we=function(t){return de[t]},xe=.9189385332046727,me=function(i,t){if(t===void 0&&(t=1),T(t).isPositive(),t<10){var r=Math.exp(-t);return function(){for(var e=r,c=0,f=i.next();f>e;)f=f-e,e=t*e/++c;return c}}else{var n=Math.sqrt(t),o=.931+2.53*n,a=-.059+.02483*o,p=1.1239+1.1328/(o-3.4),u=.9277-3.6224/(o-2);return function(){for(;;){var e=void 0,c=i.next();if(c<=.86*u)return e=c/u-.43,Math.floor((2*a/(.5-Math.abs(e))+o)*e+t+.445);c>=u?e=i.next()-.5:(e=c/u-.93,e=(e<0?-.5:.5)-e,c=i.next()*u);var f=.5-Math.abs(e);if(!(f<.013&&c>f)){var s=Math.floor((2*a/f+o)*e+t+.445);if(c=c*p/(a/(f*f)+o),s>=10){var l=(s+.5)*Math.log(t/s)-t-xe+s-(.08333333333333333-(.002777777777777778-1/(1260*s*s))/(s*s))/s;if(Math.log(c*n)<=l)return s}else if(s>=0){var h,g=(h=we(s))!=null?h:0;if(Math.log(c)<=s*Math.log(t)-t-g)return s}}}}}},ye=function(i,t){return t===void 0&&(t=1),T(t).isPositive(),function(){return-Math.log(1-i.next())/t}},be=function(i,t){return t===void 0&&(t=1),T(t).isInt().greaterThanOrEqual(0),function(){for(var r=0,n=0;n<t;++n)r+=i.next();return r}},_e=function(i,t){t===void 0&&(t=1),T(t).isInt().isPositive();var r=i.irwinHall(t);return function(){return r()/t}},Se=function(i,t){t===void 0&&(t=1),T(t).greaterThanOrEqual(0);var r=1/t;return function(){return 1/Math.pow(1-i.next(),r)}},Me=function(i){gt(t,i);function t(){return i.apply(this,arguments)||this}var r=t.prototype;return r.next=function(){return Math.random()},r.seed=function(o,a){},r.clone=function(){return new t},ot(t,[{key:"name",get:function(){return"default"}}]),t}(R),dt=function(){function i(r){var n=this;this._rng=void 0,this._patch=void 0,this._cache={},this.next=function(){return n._rng.next()},this.float=function(o,a){return n.uniform(o,a)()},this.int=function(o,a){return n.uniformInt(o,a)()},this.integer=function(o,a){return n.uniformInt(o,a)()},this.bool=function(){return n.uniformBoolean()()},this.boolean=function(){return n.uniformBoolean()()},this.uniform=function(o,a){return n._memoize("uniform",ae,o,a)},this.uniformInt=function(o,a){return n._memoize("uniformInt",ue,o,a)},this.uniformBoolean=function(){return n._memoize("uniformBoolean",le)},this.normal=function(o,a){return fe(n,o,a)},this.logNormal=function(o,a){return he(n,o,a)},this.bernoulli=function(o){return pe(n,o)},this.binomial=function(o,a){return ve(n,o,a)},this.geometric=function(o){return ge(n,o)},this.poisson=function(o){return me(n,o)},this.exponential=function(o){return ye(n,o)},this.irwinHall=function(o){return be(n,o)},this.bates=function(o){return _e(n,o)},this.pareto=function(o){return Se(n,o)},r&&r instanceof R?this.use(r):this.use(new Me),this._cache={}}var t=i.prototype;return t.clone=function(){var n=[].slice.call(arguments);return n.length?new i(ft.apply(void 0,n)):new i(this.rng.clone())},t.use=function(){this._rng=ft.apply(void 0,[].slice.call(arguments))},t.patch=function(){if(this._patch)throw new Error("Math.random already patched");this._patch=Math.random,Math.random=this.uniform()},t.unpatch=function(){this._patch&&(Math.random=this._patch,delete this._patch)},t.choice=function(n){if(!Array.isArray(n))throw new Error("Random.choice expected input to be an array, got "+typeof n);var o=n==null?void 0:n.length;if(o>0){var a=this.uniformInt(0,o-1)();return n[a]}else return},t._memoize=function(n,o){var a=[].slice.call(arguments,2),p=""+a.join(";"),u=this._cache[n];return(u===void 0||u.key!==p)&&(u={key:p,distribution:o.apply(void 0,[this].concat(a))},this._cache[n]=u),u.distribution},ot(i,[{key:"rng",get:function(){return this._rng}}]),i}();new dt;class W{constructor(t,r){d(this,"slave");d(this,"clientSignal");d(this,"clientSlot");d(this,"ai");d(this,"ID");this.slave=t,this.clientSignal=new F,this.clientSlot=new N,this.ai=r,this.ID=0,this.clientSlot.bind(async n=>{if(this.ID===n.player&&n.msg==="start"){const o=this.slave,a=await this.ai.eval(o.game.data.roll,p=>{const u=(p+this.ID)%4;return o.game.data.chess[u]});await this.clientSignal.emit(a)}})}}class Pe{constructor(t){d(this,"slave");d(this,"clientSignal");d(this,"clientSlot");d(this,"ID");d(this,"resolve");d(this,"data");this.slave=t,this.clientSignal=new F,this.clientSlot=new N,this.ID=0,this.resolve=null,this.data=rt({current:L(()=>this.slave.game.data.current),input:L(()=>this.ID===this.slave.game.data.current),roll:L(()=>this.slave.game.data.roll)}),this.clientSlot.bind(async r=>{if(r.msg==="start"&&this.data.input){const n=[];for(let o=0;o<4;o++){const a=this.slave.game.data.chess[0][o];a!==56&&(a===-1?this.data.roll===6&&n.push(o):n.push(o))}if(n.length===0)setTimeout(()=>{this.clientSignal.emit(0)},0);else if(n.length===1||n.filter(o=>this.slave.game.data.chess[0][o]===this.slave.game.data.chess[0][n[0]]).length===n.length)setTimeout(()=>{this.clientSignal.emit(n[0])},0);else{const o=await new Promise(a=>{this.resolve=a});await this.clientSignal.emit(o)}}})}choose(t){if(this.resolve){const r=this.resolve;this.resolve=null,r(t)}}}class Ee{constructor(t,r){d(this,"slave");d(this,"mainBroadcast");d(this,"clientSignal");d(this,"gen");d(this,"data");d(this,"queue");d(this,"clients");this.slave=r,this.mainBroadcast=new vt,this.clientSignal=new F,this.mainBroadcast.slot.bind(async n=>{this.queue.push(n)}),this.gen=new dt,this.gen.use(t.seed),this.data=rt({chess:{0:{0:-1,1:-1,2:-1,3:-1},1:{0:-1,1:-1,2:-1,3:-1},2:{0:-1,1:-1,2:-1,3:-1},3:{0:-1,1:-1,2:-1,3:-1}},group:t.group,current:0,fin:{0:!1,1:!1,2:!1,3:!1},roll:1,order:[]}),this.queue=new it,this.clients=Array.from({length:4},()=>null)}remap(t,r){if(r<=0||r>=51)return-1;const n=(t+4-this.data.current)%4;return r+13*n<=50?r+13*n:r>13*(4-n)?r-13*(4-n):-1}async play(){for(;;){if(this.data.fin[this.data.current]){if(this.data.current=(this.data.current+1)%4,this.data.order.length===4)return this.data.order[0];continue}const t=this.gen.int(1,6);this.data.roll=t;let r=0;const n=[];for(let u=0;u<4;u++){const e=this.data.chess[this.data.current][u];e!==56&&(e!==-1||t===6)&&n.push(u)}if(n.length===0){await this.clientSignal.emit({msg:"start",player:this.data.current}),r=await this.queue.pop(),await this.clientSignal.emit({msg:"end",player:this.data.current}),this.data.current=(this.data.current+1)%4;continue}do await this.clientSignal.emit({msg:"start",player:this.data.current}),r=await this.queue.pop();while(!n.includes(r));const o=this.data.chess[this.data.current][r],a=[];if(o===-1)t===6&&a.push(0);else if(o+t===56)a.push(56);else if(o+t>56)a.push(56),a.push(56-(o+t-56));else if(o+t>=50)a.push(o+t);else{let u=o+t,e=!1;if(a.push(u),u===18&&(e=!0,u=30,a.push(u)),u%4===2&&(u+=4,a.push(u)),u===18&&(e=!0,u=30,a.push(u)),e){const c=this.data.current^2;for(let f=0;f<4;f++)this.data.chess[c][f]===53&&(this.data.chess[c][f]=-1)}}for(const u of a){this.data.chess[this.data.current][r]=u;for(let e=0;e<4;e++)if(e!==this.data.current)for(let c=0;c<4;c++)this.remap(e,this.data.chess[e][c])===u&&this.data.group[e]!==this.data.group[this.data.current]&&(this.data.chess[e][c]=-1);await new Promise(e=>setTimeout(e,0))}let p=!0;for(let u=0;u<4;u++)this.data.chess[this.data.current][u]!==56&&(p=!1);p&&(this.data.fin[this.data.current]=!0,this.data.order.push(this.data.current)),await this.clientSignal.emit({msg:"end",player:this.data.current}),(t!==6||p)&&(this.data.current=(this.data.current+1)%4)}}}class Ie{constructor(t,r){d(this,"games");this.games=[];const n=[];for(let a=0;a<4;a++){const p=new Ot(e=>{const c=new Ee(t,e);return this.games.push(c),c});n.push(p.getClientConnection());const u=p.bind(r[a]);u.ID=a,p.game.clients[a]=u,p.poll()}new $t(n).poll()}start(){this.games.forEach(t=>t.play())}}const Ce=ht({__name:"GameView",setup(i){const t=zt(),r=Dt(),n=yt(r.query.config)||{seed:"0",group:[0,1,2,3]},o=new Ie(n,[p=>new Pe(p),p=>new W(p,new U),p=>new W(p,new U),p=>new W(p,new U)]);o.start();function a(){t.push({name:"config"})}return(p,u)=>(pt(),Tt(bt,{class:"ma-1 d-flex flex-column"},{default:$(()=>[G(St,null,{default:$(()=>[G(_t,{color:"red",onClick:u[0]||(u[0]=e=>a())},{default:$(()=>[V("返回")]),_:1})]),_:1}),G(st,null,{default:$(()=>[V(" 当前种子: "+ct(H(r).query.seed),1)]),_:1}),G(st,null,{default:$(()=>[V(" 排名: "+ct(H(o).games[0].data.order.map(e=>"红黄蓝绿".substring(e,e+1)).join(" ")),1)]),_:1}),G(Nt,{client:H(o).games[0].clients[0]},null,8,["client"])]),_:1}))}});export{Ce as default};
