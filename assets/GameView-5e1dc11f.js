var dt=Object.defineProperty;var wt=(i,t,r)=>t in i?dt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[t]=r;var d=(i,t,r)=>(wt(i,typeof t!="symbol"?t+"":t,r),r);import{N as lt,O as xt,r as mt,D as yt,ah as it,ai as bt,w as _t,a2 as et,i as $,R as ft,aj as St,ak as Pt,al as Mt,P as Et,Q as X,am as It,b as L,S as ot,an as qt,A as st,U as kt}from"./index-91cfdbf2.js";import{f as jt,i as Ct,j as Tt,h as At}from"./VCard-3f4b79ed.js";const Dt={class:"ma-auto"},Bt=lt({__name:"ChessGame",props:{client:null},setup(i){const t=i,r=xt(),e=Math.floor((document.body.clientWidth-5)/10-1)*10,s=mt(null),o=new it;yt(()=>{var _;const v=(_=s.value)==null?void 0:_.getContext("2d");setInterval(h(v),1e3/20),o.push({x:20,y:30}),o.push({x:50,y:70}),o.push({x:100,y:0})});const p=[[0,1,60,110],[0,0,110,80],[0,1,160,30],[0,0,330,140],[0,0,330,220],[0,1,160,330],[0,0,110,280],[0,1,60,250],[0,0,30,180],[1,3,230,50],[1,2,270,130],[1,1,270,230],[1,0,230,310],[2,0,60,180],[2,0,80,180],[2,0,100,180],[2,0,120,180],[2,0,140,180]],u=[[15,105],[38,118],[60,110],[80,110],[102,118],[118,102],[110,80],[110,60],[118,38],[140,30],[160,30],[180,30],[200,30],[220,30],[242,38],[250,60],[250,80],[242,102],[258,118],[280,110],[300,110],[322,118],[330,140],[330,160],[330,180],[330,200],[330,220],[322,242],[300,250],[280,250],[258,242],[242,258],[250,280],[250,300],[242,322],[220,330],[200,330],[180,330],[160,330],[140,330],[118,322],[110,300],[110,280],[118,258],[102,242],[80,250],[60,250],[38,242],[30,220],[30,200],[30,180],[60,180],[80,180],[100,180],[120,180],[140,180],[160,180]],n=[[40,40],[40,60],[60,40],[60,60]],c=["#FF3F3F","#CFCF00","#00CFFF","#00CF00"];function f(v,_){const[x,q]=_;switch(v){case 0:return[x,q];case 1:return[360-q,x];case 2:return[360-x,360-q];case 3:return[q,360-x]}}function a(v,_,x){return x>=0?f(v,u[x]):f(v,n[_])}const l=[];function h(v){const _=new Path2D;_.rect(0,0,360,360);const x=new Path2D;x.ellipse(0,0,8,8,0,0,Math.PI*2);const q=new Path2D;q.rect(-20,-10,40,20);const A=new Path2D("M 0 0 L 40 0 L 0 40 z"),w=new Path2D;w.rect(-10,-10,20,20);const b=[q,A,w],I=new Path2D("M -2 -10 L 2 -10 L 2 0 L 4 0 L 0 10 L -4 0 L -2 0 z"),P=new Path2D;P.rect(20,20,60,60);const M=new Path2D("M 150 150 L 180 180 L 150 210 z"),k=y=>{v.translate(180,180),v.rotate(y*Math.PI/180),v.translate(-180,-180)},j=y=>{v.save(),y(),v.restore()},S=(y,m)=>{j(()=>{m.translate&&v.translate(m.translate.x,m.translate.y),m.rotate&&v.rotate(m.rotate*Math.PI/180),m.fill&&(v.fillStyle=m.fill,v.fill(y)),m.stroke&&(v.strokeStyle=m.stroke,v.stroke(y))})},C=t.client.slave.game.data;for(let y=0;y<4;y++)for(let m=0;m<4;m++){const D=a(y,m,C.chess[y][m]),E=new it({x:D[0],y:D[1]});bt(E),_t(()=>C.chess[y][m],B=>{const F=a(y,m,B);E.push({x:F[0],y:F[1]})}),l.push(et({pos:E,player:y,chess:m,place:$(()=>C.chess[y][m])}))}return k(-90),()=>{S(_,{fill:"wheat"});for(const[y,m]of c.entries()){j(()=>{k(y*90);for(const E of p)S(b[E[0]],{translate:{x:E[2],y:E[3]},rotate:E[1]*90,fill:m,stroke:"black"});S(x,{translate:{x:15,y:105},fill:"white",stroke:"black"}),S(P,{fill:m,stroke:t.client.data.current===y?"yellow":"black"}),S(x,{translate:{x:40,y:40},fill:"white",stroke:"black"}),S(x,{translate:{x:40,y:60},fill:"white",stroke:"black"}),S(x,{translate:{x:60,y:40},fill:"white",stroke:"black"}),S(x,{translate:{x:60,y:60},fill:"white",stroke:"black"}),S(M,{fill:m,stroke:"black"}),S(I,{translate:{x:260,y:150},fill:m,stroke:"black"}),S(I,{translate:{x:260,y:210},fill:m,stroke:"black"})});const D=new Set;l.forEach(E=>{j(()=>{const B=E.pos.get();if(!E.pos.moving){for(;D.has(`${B.x},${B.y}`);)B.x+=2,B.y+=3;D.add(`${B.x},${B.y}`)}const{x:F,y:gt}=B;v.translate(F,gt),v.fillStyle="white",v.fill(x),v.stroke(x),v.fillStyle=c[E.player],v.beginPath(),v.ellipse(0,0,5,5,0,0,Math.PI*2),v.closePath(),v.fill()})}),v.font="16pt consolas",j(()=>{const E=f((t.client.data.current+3)%4,[10,10]);k(90),v.fillStyle="red",v.fillText(t.client.data.roll.toString(),E[0]-5,E[1]+5)})}}}function g(v){let _=-1;for(let x=0;x<4;x++){const q=a(3,x,t.client.slave.game.data.chess[0][x]),A=v.offsetX*360/e-q[0],w=v.offsetY*360/e-q[1];if(A*A+w*w<144){_=x;break}}_!==-1&&t.client.choose(_)}return t.client.clientSlot.bind(async v=>{v.msg==="end"&&!t.client.slave.game.data.fin[0]&&await Promise.all(l.map(_=>_.pos.wait()).concat([new Promise(_=>setTimeout(_,r.actionSpeed))]))}),(v,_)=>(ft(),St("div",Dt,[Pt("canvas",{ref_key:"canvasEl",ref:s,style:Mt({width:`${e}px`,height:`${e}px`}),width:"360",height:"360",onClick:g},null,4)]))}});class V{async eval(t,r){const e=r(0);if(t===6){for(let o=0;o<4;o++)if(e[o]===-1)return o}const s=[];for(let o=0;o<4;o++){const p=e[o];p===56||p===-1||s.push(o)}for(const o of s)if(e[o]+t===56)return o;for(const o of s)if(e[o]+t===14||e[o]+t===18)return o;for(const o of s)if(e[o]+t<=46&&(e[o]+t)%4===2)return o;for(const o of s)if(e[o]+t<56)return o;return s[0]||0}}var O=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ot(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var r=function e(){if(this instanceof e){var s=[null];s.push.apply(s,arguments);var o=Function.bind.apply(t,s);return new o}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(i).forEach(function(e){var s=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(r,e,s.get?s:{enumerable:!0,get:function(){return i[e]}})}),r}var Q={},zt={get exports(){return Q},set exports(i){Q=i}};(function(i){(function(t,r,e){function s(n){var c=this,f=u();c.next=function(){var a=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=a-(c.c=a|0)},c.c=1,c.s0=f(" "),c.s1=f(" "),c.s2=f(" "),c.s0-=f(n),c.s0<0&&(c.s0+=1),c.s1-=f(n),c.s1<0&&(c.s1+=1),c.s2-=f(n),c.s2<0&&(c.s2+=1),f=null}function o(n,c){return c.c=n.c,c.s0=n.s0,c.s1=n.s1,c.s2=n.s2,c}function p(n,c){var f=new s(n),a=c&&c.state,l=f.next;return l.int32=function(){return f.next()*4294967296|0},l.double=function(){return l()+(l()*2097152|0)*11102230246251565e-32},l.quick=l,a&&(typeof a=="object"&&o(a,f),l.state=function(){return o(f,{})}),l}function u(){var n=4022871197,c=function(f){f=String(f);for(var a=0;a<f.length;a++){n+=f.charCodeAt(a);var l=.02519603282416938*n;n=l>>>0,l-=n,l*=n,n=l>>>0,l-=n,n+=l*4294967296}return(n>>>0)*23283064365386963e-26};return c}r&&r.exports?r.exports=p:e&&e.amd?e(function(){return p}):this.alea=p})(O,i,!1)})(zt);var U={},$t={get exports(){return U},set exports(i){U=i}};(function(i){(function(t,r,e){function s(u){var n=this,c="";n.x=0,n.y=0,n.z=0,n.w=0,n.next=function(){var a=n.x^n.x<<11;return n.x=n.y,n.y=n.z,n.z=n.w,n.w^=n.w>>>19^a^a>>>8},u===(u|0)?n.x=u:c+=u;for(var f=0;f<c.length+64;f++)n.x^=c.charCodeAt(f)|0,n.next()}function o(u,n){return n.x=u.x,n.y=u.y,n.z=u.z,n.w=u.w,n}function p(u,n){var c=new s(u),f=n&&n.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},a.int32=c.next,a.quick=a,f&&(typeof f=="object"&&o(f,c),a.state=function(){return o(c,{})}),a}r&&r.exports?r.exports=p:e&&e.amd?e(function(){return p}):this.xor128=p})(O,i,!1)})($t);var K={},Gt={get exports(){return K},set exports(i){K=i}};(function(i){(function(t,r,e){function s(u){var n=this,c="";n.next=function(){var a=n.x^n.x>>>2;return n.x=n.y,n.y=n.z,n.z=n.w,n.w=n.v,(n.d=n.d+362437|0)+(n.v=n.v^n.v<<4^(a^a<<1))|0},n.x=0,n.y=0,n.z=0,n.w=0,n.v=0,u===(u|0)?n.x=u:c+=u;for(var f=0;f<c.length+64;f++)n.x^=c.charCodeAt(f)|0,f==c.length&&(n.d=n.x<<10^n.x>>>4),n.next()}function o(u,n){return n.x=u.x,n.y=u.y,n.z=u.z,n.w=u.w,n.v=u.v,n.d=u.d,n}function p(u,n){var c=new s(u),f=n&&n.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},a.int32=c.next,a.quick=a,f&&(typeof f=="object"&&o(f,c),a.state=function(){return o(c,{})}),a}r&&r.exports?r.exports=p:e&&e.amd?e(function(){return p}):this.xorwow=p})(O,i,!1)})(Gt);var W={},Nt={get exports(){return W},set exports(i){W=i}};(function(i){(function(t,r,e){function s(u){var n=this;n.next=function(){var f=n.x,a=n.i,l,h;return l=f[a],l^=l>>>7,h=l^l<<24,l=f[a+1&7],h^=l^l>>>10,l=f[a+3&7],h^=l^l>>>3,l=f[a+4&7],h^=l^l<<7,l=f[a+7&7],l=l^l<<13,h^=l^l<<9,f[a]=h,n.i=a+1&7,h};function c(f,a){var l,h=[];if(a===(a|0))h[0]=a;else for(a=""+a,l=0;l<a.length;++l)h[l&7]=h[l&7]<<15^a.charCodeAt(l)+h[l+1&7]<<13;for(;h.length<8;)h.push(0);for(l=0;l<8&&h[l]===0;++l);for(l==8?h[7]=-1:h[l],f.x=h,f.i=0,l=256;l>0;--l)f.next()}c(n,u)}function o(u,n){return n.x=u.x.slice(),n.i=u.i,n}function p(u,n){u==null&&(u=+new Date);var c=new s(u),f=n&&n.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},a.int32=c.next,a.quick=a,f&&(f.x&&o(f,c),a.state=function(){return o(c,{})}),a}r&&r.exports?r.exports=p:e&&e.amd?e(function(){return p}):this.xorshift7=p})(O,i,!1)})(Nt);var Y={},Ft={get exports(){return Y},set exports(i){Y=i}};(function(i){(function(t,r,e){function s(u){var n=this;n.next=function(){var f=n.w,a=n.X,l=n.i,h,g;return n.w=f=f+1640531527|0,g=a[l+34&127],h=a[l=l+1&127],g^=g<<13,h^=h<<17,g^=g>>>15,h^=h>>>12,g=a[l]=g^h,n.i=l,g+(f^f>>>16)|0};function c(f,a){var l,h,g,v,_,x=[],q=128;for(a===(a|0)?(h=a,a=null):(a=a+"\0",h=0,q=Math.max(q,a.length)),g=0,v=-32;v<q;++v)a&&(h^=a.charCodeAt((v+32)%a.length)),v===0&&(_=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,v>=0&&(_=_+1640531527|0,l=x[v&127]^=h+_,g=l==0?g+1:0);for(g>=128&&(x[(a&&a.length||0)&127]=-1),g=127,v=4*128;v>0;--v)h=x[g+34&127],l=x[g=g+1&127],h^=h<<13,l^=l<<17,h^=h>>>15,l^=l>>>12,x[g]=h^l;f.w=_,f.X=x,f.i=g}c(n,u)}function o(u,n){return n.i=u.i,n.w=u.w,n.X=u.X.slice(),n}function p(u,n){u==null&&(u=+new Date);var c=new s(u),f=n&&n.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},a.int32=c.next,a.quick=a,f&&(f.X&&o(f,c),a.state=function(){return o(c,{})}),a}r&&r.exports?r.exports=p:e&&e.amd?e(function(){return p}):this.xor4096=p})(O,i,!1)})(Ft);var J={},Xt={get exports(){return J},set exports(i){J=i}};(function(i){(function(t,r,e){function s(u){var n=this,c="";n.next=function(){var a=n.b,l=n.c,h=n.d,g=n.a;return a=a<<25^a>>>7^l,l=l-h|0,h=h<<24^h>>>8^g,g=g-a|0,n.b=a=a<<20^a>>>12^l,n.c=l=l-h|0,n.d=h<<16^l>>>16^g,n.a=g-a|0},n.a=0,n.b=0,n.c=-1640531527,n.d=1367130551,u===Math.floor(u)?(n.a=u/4294967296|0,n.b=u|0):c+=u;for(var f=0;f<c.length+20;f++)n.b^=c.charCodeAt(f)|0,n.next()}function o(u,n){return n.a=u.a,n.b=u.b,n.c=u.c,n.d=u.d,n}function p(u,n){var c=new s(u),f=n&&n.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},a.int32=c.next,a.quick=a,f&&(typeof f=="object"&&o(f,c),a.state=function(){return o(c,{})}),a}r&&r.exports?r.exports=p:e&&e.amd?e(function(){return p}):this.tychei=p})(O,i,!1)})(Xt);var Z={},Lt={get exports(){return Z},set exports(i){Z=i}};const Rt={},Vt=Object.freeze(Object.defineProperty({__proto__:null,default:Rt},Symbol.toStringTag,{value:"Module"})),Ht=Ot(Vt);(function(i){(function(t,r,e){var s=256,o=6,p=52,u="random",n=e.pow(s,o),c=e.pow(2,p),f=c*2,a=s-1,l;function h(w,b,I){var P=[];b=b==!0?{entropy:!0}:b||{};var M=x(_(b.entropy?[w,A(r)]:w??q(),3),P),k=new g(P),j=function(){for(var S=k.g(o),C=n,y=0;S<c;)S=(S+y)*s,C*=s,y=k.g(1);for(;S>=f;)S/=2,C/=2,y>>>=1;return(S+y)/C};return j.int32=function(){return k.g(4)|0},j.quick=function(){return k.g(4)/4294967296},j.double=j,x(A(k.S),r),(b.pass||I||function(S,C,y,m){return m&&(m.S&&v(m,k),S.state=function(){return v(k,{})}),y?(e[u]=S,C):S})(j,M,"global"in b?b.global:this==e,b.state)}function g(w){var b,I=w.length,P=this,M=0,k=P.i=P.j=0,j=P.S=[];for(I||(w=[I++]);M<s;)j[M]=M++;for(M=0;M<s;M++)j[M]=j[k=a&k+w[M%I]+(b=j[M])],j[k]=b;(P.g=function(S){for(var C,y=0,m=P.i,D=P.j,E=P.S;S--;)C=E[m=a&m+1],y=y*s+E[a&(E[m]=E[D=a&D+C])+(E[D]=C)];return P.i=m,P.j=D,y})(s)}function v(w,b){return b.i=w.i,b.j=w.j,b.S=w.S.slice(),b}function _(w,b){var I=[],P=typeof w,M;if(b&&P=="object")for(M in w)try{I.push(_(w[M],b-1))}catch{}return I.length?I:P=="string"?w:w+"\0"}function x(w,b){for(var I=w+"",P,M=0;M<I.length;)b[a&M]=a&(P^=b[a&M]*19)+I.charCodeAt(M++);return A(b)}function q(){try{var w;return l&&(w=l.randomBytes)?w=w(s):(w=new Uint8Array(s),(t.crypto||t.msCrypto).getRandomValues(w)),A(w)}catch{var b=t.navigator,I=b&&b.plugins;return[+new Date,t,I,t.screen,A(r)]}}function A(w){return String.fromCharCode.apply(0,w)}if(x(e.random(),r),i.exports){i.exports=h;try{l=Ht}catch{}}else e["seed"+u]=h})(typeof self<"u"?self:O,[],Math)})(Lt);var Qt=Q,Ut=U,Kt=K,Wt=W,Yt=Y,Jt=J,z=Z;z.alea=Qt;z.xor128=Ut;z.xorwow=Kt;z.xorshift7=Wt;z.xor4096=Yt;z.tychei=Jt;var Zt=z;function at(i,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,ee(e.key),e)}}function nt(i,t,r){return t&&at(i.prototype,t),r&&at(i,r),Object.defineProperty(i,"prototype",{writable:!1}),i}function ht(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i,tt(i,t)}function tt(i,t){return tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,s){return e.__proto__=s,e},tt(i,t)}function te(i,t){if(typeof i!="object"||i===null)return i;var r=i[Symbol.toPrimitive];if(r!==void 0){var e=r.call(i,t||"default");if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(i)}function ee(i){var t=te(i,"string");return typeof t=="symbol"?t:String(t)}var R=function(){function i(){}var t=i.prototype;return t._seed=function(e,s){if(e===(e||0))return e;for(var o=""+e,p=0,u=0;u<o.length;++u)p^=o.charCodeAt(u)|0;return p},i}(),ct=function(i){ht(t,i);function t(e,s){var o;return o=i.call(this)||this,o._rng=void 0,o.seed(e,s),o}var r=t.prototype;return r.next=function(){return this._rng()},r.seed=function(s,o){this._rng=s},r.clone=function(s,o){return new t(this._rng,o)},nt(t,[{key:"name",get:function(){return"function"}}]),t}(R),ut=function(){var i=[].slice.call(arguments),t=i,r=t[0],e=r===void 0?"default":r;switch(typeof e){case"object":if(e instanceof R)return e;break;case"function":return new ct(e);case"number":case"string":default:return new ct(Zt.apply(void 0,i))}throw new Error('invalid RNG "'+e+'"')},ne=function(i,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),function(){return i.next()*(r-t)+t}};function T(i){return new re(i)}var re=function(t){var r=this;this.n=void 0,this.isInt=function(){if(Number.isInteger(r.n))return r;throw new Error("Expected number to be an integer, got "+r.n)},this.isPositive=function(){if(r.n>0)return r;throw new Error("Expected number to be positive, got "+r.n)},this.lessThan=function(e){if(r.n<e)return r;throw new Error("Expected number to be less than "+e+", got "+r.n)},this.greaterThanOrEqual=function(e){if(r.n>=e)return r;throw new Error("Expected number to be greater than or equal to "+e+", got "+r.n)},this.greaterThan=function(e){if(r.n>e)return r;throw new Error("Expected number to be greater than "+e+", got "+r.n)},this.n=t},ie=function(i,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),r===void 0&&(r=t===void 0?1:t,t=0),T(t).isInt(),T(r).isInt(),function(){return Math.floor(i.next()*(r-t+1)+t)}},oe=function(i){return function(){return i.next()>=.5}},se=function(i,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),function(){var e,s,o;do e=i.next()*2-1,s=i.next()*2-1,o=e*e+s*s;while(!o||o>1);return t+r*s*Math.sqrt(-2*Math.log(o)/o)}},ae=function(i,t,r){t===void 0&&(t=0),r===void 0&&(r=1);var e=i.normal(t,r);return function(){return Math.exp(e())}},ce=function(i,t){return t===void 0&&(t=.5),T(t).greaterThanOrEqual(0).lessThan(1),function(){return Math.floor(i.next()+t)}},ue=function(i,t,r){return t===void 0&&(t=1),r===void 0&&(r=.5),T(t).isInt().isPositive(),T(r).greaterThanOrEqual(0).lessThan(1),function(){for(var e=0,s=0;e++<t;)i.next()<r&&s++;return s}},le=function(i,t){t===void 0&&(t=.5),T(t).greaterThan(0).lessThan(1);var r=1/Math.log(1-t);return function(){return Math.floor(1+Math.log(i.next())*r)}},fe=[0,0,.6931471805599453,1.791759469228055,3.1780538303479458,4.787491742782046,6.579251212010101,8.525161361065415,10.60460290274525,12.801827480081469],he=function(t){return fe[t]},pe=.9189385332046727,ve=function(i,t){if(t===void 0&&(t=1),T(t).isPositive(),t<10){var r=Math.exp(-t);return function(){for(var n=r,c=0,f=i.next();f>n;)f=f-n,n=t*n/++c;return c}}else{var e=Math.sqrt(t),s=.931+2.53*e,o=-.059+.02483*s,p=1.1239+1.1328/(s-3.4),u=.9277-3.6224/(s-2);return function(){for(;;){var n=void 0,c=i.next();if(c<=.86*u)return n=c/u-.43,Math.floor((2*o/(.5-Math.abs(n))+s)*n+t+.445);c>=u?n=i.next()-.5:(n=c/u-.93,n=(n<0?-.5:.5)-n,c=i.next()*u);var f=.5-Math.abs(n);if(!(f<.013&&c>f)){var a=Math.floor((2*o/f+s)*n+t+.445);if(c=c*p/(o/(f*f)+s),a>=10){var l=(a+.5)*Math.log(t/a)-t-pe+a-(.08333333333333333-(.002777777777777778-1/(1260*a*a))/(a*a))/a;if(Math.log(c*e)<=l)return a}else if(a>=0){var h,g=(h=he(a))!=null?h:0;if(Math.log(c)<=a*Math.log(t)-t-g)return a}}}}}},ge=function(i,t){return t===void 0&&(t=1),T(t).isPositive(),function(){return-Math.log(1-i.next())/t}},de=function(i,t){return t===void 0&&(t=1),T(t).isInt().greaterThanOrEqual(0),function(){for(var r=0,e=0;e<t;++e)r+=i.next();return r}},we=function(i,t){t===void 0&&(t=1),T(t).isInt().isPositive();var r=i.irwinHall(t);return function(){return r()/t}},xe=function(i,t){t===void 0&&(t=1),T(t).greaterThanOrEqual(0);var r=1/t;return function(){return 1/Math.pow(1-i.next(),r)}},me=function(i){ht(t,i);function t(){return i.apply(this,arguments)||this}var r=t.prototype;return r.next=function(){return Math.random()},r.seed=function(s,o){},r.clone=function(){return new t},nt(t,[{key:"name",get:function(){return"default"}}]),t}(R),pt=function(){function i(r){var e=this;this._rng=void 0,this._patch=void 0,this._cache={},this.next=function(){return e._rng.next()},this.float=function(s,o){return e.uniform(s,o)()},this.int=function(s,o){return e.uniformInt(s,o)()},this.integer=function(s,o){return e.uniformInt(s,o)()},this.bool=function(){return e.uniformBoolean()()},this.boolean=function(){return e.uniformBoolean()()},this.uniform=function(s,o){return e._memoize("uniform",ne,s,o)},this.uniformInt=function(s,o){return e._memoize("uniformInt",ie,s,o)},this.uniformBoolean=function(){return e._memoize("uniformBoolean",oe)},this.normal=function(s,o){return se(e,s,o)},this.logNormal=function(s,o){return ae(e,s,o)},this.bernoulli=function(s){return ce(e,s)},this.binomial=function(s,o){return ue(e,s,o)},this.geometric=function(s){return le(e,s)},this.poisson=function(s){return ve(e,s)},this.exponential=function(s){return ge(e,s)},this.irwinHall=function(s){return de(e,s)},this.bates=function(s){return we(e,s)},this.pareto=function(s){return xe(e,s)},r&&r instanceof R?this.use(r):this.use(new me),this._cache={}}var t=i.prototype;return t.clone=function(){var e=[].slice.call(arguments);return e.length?new i(ut.apply(void 0,e)):new i(this.rng.clone())},t.use=function(){this._rng=ut.apply(void 0,[].slice.call(arguments))},t.patch=function(){if(this._patch)throw new Error("Math.random already patched");this._patch=Math.random,Math.random=this.uniform()},t.unpatch=function(){this._patch&&(Math.random=this._patch,delete this._patch)},t.choice=function(e){if(!Array.isArray(e))throw new Error("Random.choice expected input to be an array, got "+typeof e);var s=e==null?void 0:e.length;if(s>0){var o=this.uniformInt(0,s-1)();return e[o]}else return},t._memoize=function(e,s){var o=[].slice.call(arguments,2),p=""+o.join(";"),u=this._cache[e];return(u===void 0||u.key!==p)&&(u={key:p,distribution:s.apply(void 0,[this].concat(o))},this._cache[e]=u),u.distribution},nt(i,[{key:"rng",get:function(){return this._rng}}]),i}();new pt;class ye{constructor(){d(this,"res");this.res=null}async enter(){return this.res?(await new Promise(t=>{var r;(r=this.res)==null||r.push(t)}),!1):(this.res=[],!0)}leave(){this.res&&(this.res.length>0?this.res.shift()():this.res=null)}}class rt{constructor(){d(this,"section");d(this,"items");d(this,"resolves");this.section=new ye,this.items=[],this.resolves=[]}push(t,r=!0){const e=this.resolves.shift();e?this.section.enter().then(s=>{s&&r?setTimeout(()=>{e(t),this.section.leave()},0):(e(t),this.section.leave())}):this.items.push(t)}async pop(){return this.items.length>0?this.items.shift():new Promise(t=>{this.resolves.push(t)})}}class G{constructor(){d(this,"slots");this.slots=[]}connect(t){this.slots.push(t)}disconnect(t){t?this.slots=this.slots.filter(r=>r===t):this.slots=[]}async emit(t,r=!1){if(r)await Promise.all(this.slots.map(e=>e.exec(t)));else for(const e of this.slots)await e.exec(t)}}class N{constructor(){d(this,"action");this.action=[]}async exec(t){for(const r of this.action)await r(t)}bind(t){this.action.push(t)}}class vt{constructor(t=!1){d(this,"signal");d(this,"slot");this.signal=new G,this.slot=new N,this.slot.bind(async r=>{await this.signal.emit(r,t)})}}class be{constructor(t){d(this,"game");this.game=t}async exec(t){for(;!t();){const r=await this.game.queue.pop();await this.game.game.mainBroadcast.slot.exec(r)}}}class _e{constructor(t){d(this,"game");d(this,"loop");d(this,"queue");d(this,"mainSlot");d(this,"clientBroadcast");this.game=t(this),this.loop=new be(this),this.queue=new rt,this.mainSlot=new N,this.mainSlot.bind(async r=>{this.queue.push(r)}),this.clientBroadcast=new vt}async poll(t=()=>!1){await this.loop.exec(t)}bind(t){const r=t(this);return this.game.clientSignal.connect(r.clientSlot),r.clientSignal.connect(this.clientBroadcast.slot),r}getClientConnection(){return{signal:this.clientBroadcast.signal,slot:this.mainSlot}}}class Se{constructor(t){d(this,"connections");d(this,"queue");const r=new N;r.bind(async e=>{this.queue.push(e)}),this.connections=t,this.queue=new rt,t.forEach(e=>{e.signal.connect(r)})}async poll(t=()=>!1){const r=new G;for(this.connections.forEach(e=>{r.connect(e.slot)});!t();){const e=await this.queue.pop();await r.emit(e,!0)}}}class H{constructor(t,r){d(this,"slave");d(this,"clientSignal");d(this,"clientSlot");d(this,"ai");d(this,"ID");this.slave=t,this.clientSignal=new G,this.clientSlot=new N,this.ai=r,this.ID=0,this.clientSlot.bind(async e=>{if(this.ID===e.player&&e.msg==="start"){const s=this.slave,o=await this.ai.eval(s.game.data.roll,p=>{const u=(p+this.ID)%4;return s.game.data.chess[u]});await this.clientSignal.emit(o)}})}}class Pe{constructor(t){d(this,"slave");d(this,"clientSignal");d(this,"clientSlot");d(this,"ID");d(this,"resolve");d(this,"data");this.slave=t,this.clientSignal=new G,this.clientSlot=new N,this.ID=0,this.resolve=null,this.data=et({current:$(()=>this.slave.game.data.current),input:$(()=>this.ID===this.slave.game.data.current),roll:$(()=>this.slave.game.data.roll)}),this.clientSlot.bind(async r=>{if(r.msg==="start"&&this.data.input){const e=[];for(let s=0;s<4;s++){const o=this.slave.game.data.chess[0][s];o!==56&&(o===-1?this.data.roll===6&&e.push(s):e.push(s))}if(e.length===0)setTimeout(()=>{this.clientSignal.emit(0)},0);else if(e.length===1||e.filter(s=>this.slave.game.data.chess[0][s]===this.slave.game.data.chess[0][e[0]]).length===e.length)setTimeout(()=>{this.clientSignal.emit(e[0])},0);else{const s=await new Promise(o=>{this.resolve=o});await this.clientSignal.emit(s)}}})}choose(t){if(this.resolve){const r=this.resolve;this.resolve=null,r(t)}}}class Me{constructor(t,r){d(this,"slave");d(this,"mainBroadcast");d(this,"clientSignal");d(this,"gen");d(this,"data");d(this,"queue");d(this,"clients");this.slave=r,this.mainBroadcast=new vt,this.clientSignal=new G,this.mainBroadcast.slot.bind(async e=>{this.queue.push(e)}),this.gen=new pt,this.gen.use(t),this.data=et({chess:{0:{0:-1,1:-1,2:-1,3:-1},1:{0:-1,1:-1,2:-1,3:-1},2:{0:-1,1:-1,2:-1,3:-1},3:{0:-1,1:-1,2:-1,3:-1}},current:0,fin:{0:!1,1:!1,2:!1,3:!1},roll:1,animation:$(()=>!this.data.fin[0])}),this.queue=new rt,this.clients=Array.from({length:4},()=>null)}remap(t,r){if(r<=0||r>=51)return-1;const e=(t+4-this.data.current)%4;return r+13*e<=50?r+13*e:r>13*(4-e)?r-13*(4-e):-1}async play(){for(;;){if(this.data.fin[this.data.current]){this.data.current=(this.data.current+1)%4;let u=!0;for(let n=0;n<4;n++)this.data.fin[n]||(u=!1);if(u)return 0;continue}const t=this.gen.int(1,6);this.data.roll=t;let r=0;const e=[];for(let u=0;u<4;u++){const n=this.data.chess[this.data.current][u];n!==56&&(n!==-1||t===6)&&e.push(u)}if(e.length===0){await this.clientSignal.emit({msg:"start",player:this.data.current}),r=await this.queue.pop(),await this.clientSignal.emit({msg:"end",player:this.data.current}),this.data.current=(this.data.current+1)%4;continue}do await this.clientSignal.emit({msg:"start",player:this.data.current}),r=await this.queue.pop();while(!e.includes(r));const s=this.data.chess[this.data.current][r],o=[];if(s===-1)t===6&&o.push(0);else if(s+t===56)o.push(56);else if(s+t>56)o.push(56),o.push(56-(s+t-56));else if(s+t>=50)o.push(s+t);else{let u=s+t,n=!1;if(o.push(u),u===18&&(n=!0,u=30,o.push(u)),u%4===2&&(u+=4,o.push(u)),u===18&&(n=!0,u=30,o.push(u)),n){const c=this.data.current^2;for(let f=0;f<4;f++)this.data.chess[c][f]===53&&(this.data.chess[c][f]=-1)}}for(const u of o){this.data.chess[this.data.current][r]=u;for(let n=0;n<4;n++)if(n!==this.data.current)for(let c=0;c<4;c++)this.remap(n,this.data.chess[n][c])===u&&(this.data.chess[n][c]=-1);await new Promise(n=>setTimeout(n,0))}let p=!0;for(let u=0;u<4;u++)this.data.chess[this.data.current][u]!==56&&(p=!1);p&&(this.data.fin[this.data.current]=!0),await this.clientSignal.emit({msg:"end",player:this.data.current}),(t!==6||p)&&(this.data.current=(this.data.current+1)%4)}}}class Ee{constructor(t,r){d(this,"games");this.games=[];const e=[];for(let o=0;o<4;o++){const p=new _e(n=>{const c=new Me(t,n);return this.games.push(c),c});e.push(p.getClientConnection());const u=p.bind(r[o]);u.ID=o,p.game.clients[o]=u,p.poll()}new Se(e).poll()}start(){this.games.forEach(t=>t.play())}}const je=lt({__name:"GameView",setup(i){const t=kt(),r=It(),e=new Ee(r.query.seed,[o=>new Pe(o),o=>new H(o,new V),o=>new H(o,new V),o=>new H(o,new V)]);e.start();function s(){t.push({name:"config"})}return(o,p)=>(ft(),Et(jt,{class:"ma-1 d-flex flex-column"},{default:X(()=>[L(Tt,null,{default:X(()=>[L(Ct,{color:"red",onClick:p[0]||(p[0]=u=>s())},{default:X(()=>[ot("返回")]),_:1})]),_:1}),L(At,null,{default:X(()=>[ot(" 当前种子: "+qt(st(r).query.seed),1)]),_:1}),L(Bt,{client:st(e).games[0].clients[0]},null,8,["client"])]),_:1}))}});export{je as default};
