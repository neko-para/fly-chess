var dt=Object.defineProperty;var wt=(i,t,r)=>t in i?dt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[t]=r;var d=(i,t,r)=>(wt(i,typeof t!="symbol"?t+"":t,r),r);import{N as lt,O as xt,r as mt,D as yt,ah as it,ai as bt,w as _t,a2 as et,i as G,R as ft,aj as St,ak as Pt,P as Mt,Q as X,al as Et,b as L,S as ot,am as It,A as st,U as kt}from"./index-a2c80f16.js";import{f as qt,i as jt,j as Ct,h as Tt}from"./VCard-ccc9673a.js";const At={class:"ma-auto"},Dt=lt({__name:"ChessGame",props:{client:null},setup(i){const t=i,r=xt(),n=360,s=mt(null),o=new it;yt(()=>{var _;const v=(_=s.value)==null?void 0:_.getContext("2d");setInterval(h(v),1e3/20),o.push({x:20,y:30}),o.push({x:50,y:70}),o.push({x:100,y:0})});const p=[[0,1,60,110],[0,0,110,80],[0,1,160,30],[0,0,330,140],[0,0,330,220],[0,1,160,330],[0,0,110,280],[0,1,60,250],[0,0,30,180],[1,3,230,50],[1,2,270,130],[1,1,270,230],[1,0,230,310],[2,0,60,180],[2,0,80,180],[2,0,100,180],[2,0,120,180],[2,0,140,180]],u=[[15,105],[38,118],[60,110],[80,110],[102,118],[118,102],[110,80],[110,60],[118,38],[140,30],[160,30],[180,30],[200,30],[220,30],[242,38],[250,60],[250,80],[242,102],[258,118],[280,110],[300,110],[322,118],[330,140],[330,160],[330,180],[330,200],[330,220],[322,242],[300,250],[280,250],[258,242],[242,258],[250,280],[250,300],[242,322],[220,330],[200,330],[180,330],[160,330],[140,330],[118,322],[110,300],[110,280],[118,258],[102,242],[80,250],[60,250],[38,242],[30,220],[30,200],[30,180],[60,180],[80,180],[100,180],[120,180],[140,180],[160,180]],e=[[40,40],[40,60],[60,40],[60,60]],c=["#FF3F3F","#CFCF00","#00CFFF","#00CF00"];function f(v,_){const[x,k]=_;switch(v){case 0:return[x,k];case 1:return[360-k,x];case 2:return[360-x,360-k];case 3:return[k,360-x]}}function a(v,_,x){return x>=0?f(v,u[x]):f(v,e[_])}const l=[];function h(v){const _=new Path2D;_.rect(0,0,n,n);const x=new Path2D;x.ellipse(0,0,8,8,0,0,Math.PI*2);const k=new Path2D;k.rect(-20,-10,40,20);const A=new Path2D("M 0 0 L 40 0 L 0 40 z"),w=new Path2D;w.rect(-10,-10,20,20);const b=[k,A,w],I=new Path2D("M -2 -10 L 2 -10 L 2 0 L 4 0 L 0 10 L -4 0 L -2 0 z"),P=new Path2D;P.rect(20,20,60,60);const M=new Path2D("M 150 150 L 180 180 L 150 210 z"),q=y=>{v.translate(180,180),v.rotate(y*Math.PI/180),v.translate(-180,-180)},j=y=>{v.save(),y(),v.restore()},S=(y,m)=>{j(()=>{m.translate&&v.translate(m.translate.x,m.translate.y),m.rotate&&v.rotate(m.rotate*Math.PI/180),m.fill&&(v.fillStyle=m.fill,v.fill(y)),m.stroke&&(v.strokeStyle=m.stroke,v.stroke(y))})},C=t.client.slave.game.data;for(let y=0;y<4;y++)for(let m=0;m<4;m++){const D=a(y,m,C.chess[y][m]),E=new it({x:D[0],y:D[1]});bt(E),_t(()=>C.chess[y][m],B=>{const F=a(y,m,B);E.push({x:F[0],y:F[1]})}),l.push(et({pos:E,player:y,chess:m,place:G(()=>C.chess[y][m])}))}return q(-90),()=>{S(_,{fill:"wheat"});for(const[y,m]of c.entries()){j(()=>{q(y*90);for(const E of p)S(b[E[0]],{translate:{x:E[2],y:E[3]},rotate:E[1]*90,fill:m,stroke:"black"});S(x,{translate:{x:15,y:105},fill:"white",stroke:"black"}),S(P,{fill:m,stroke:t.client.data.current===y?"yellow":"black"}),S(x,{translate:{x:40,y:40},fill:"white",stroke:"black"}),S(x,{translate:{x:40,y:60},fill:"white",stroke:"black"}),S(x,{translate:{x:60,y:40},fill:"white",stroke:"black"}),S(x,{translate:{x:60,y:60},fill:"white",stroke:"black"}),S(M,{fill:m,stroke:"black"}),S(I,{translate:{x:260,y:150},fill:m,stroke:"black"}),S(I,{translate:{x:260,y:210},fill:m,stroke:"black"})});const D=new Set;l.forEach(E=>{j(()=>{const B=E.pos.get();if(!E.pos.moving){for(;D.has(`${B.x},${B.y}`);)B.x+=2,B.y+=3;D.add(`${B.x},${B.y}`)}const{x:F,y:gt}=B;v.translate(F,gt),v.fillStyle="white",v.fill(x),v.stroke(x),v.fillStyle=c[E.player],v.beginPath(),v.ellipse(0,0,5,5,0,0,Math.PI*2),v.closePath(),v.fill()})}),v.font="16pt consolas",j(()=>{const E=f((t.client.data.current+3)%4,[10,10]);q(90),v.fillStyle="red",v.fillText(t.client.data.roll.toString(),E[0]-5,E[1]+5)})}}}function g(v){let _=-1;for(let x=0;x<4;x++){const k=a(3,x,t.client.slave.game.data.chess[0][x]),A=v.offsetX-k[0],w=v.offsetY-k[1];if(A*A+w*w<144){_=x;break}}_!==-1&&t.client.choose(_)}return t.client.clientSlot.bind(async v=>{v.msg==="end"&&!t.client.slave.game.data.fin[0]&&await Promise.all(l.map(_=>_.pos.wait()).concat([new Promise(_=>setTimeout(_,r.actionSpeed))]))}),(v,_)=>(ft(),St("div",At,[Pt("canvas",{ref_key:"canvasEl",ref:s,width:n,height:n,onClick:g},null,512)]))}});class V{async eval(t,r){const n=r(0);if(t===6){for(let o=0;o<4;o++)if(n[o]===-1)return o}const s=[];for(let o=0;o<4;o++){const p=n[o];p===56||p===-1||s.push(o)}for(const o of s)if(n[o]+t===56)return o;for(const o of s)if(n[o]+t===14||n[o]+t===18)return o;for(const o of s)if(n[o]+t<=46&&(n[o]+t)%4===2)return o;for(const o of s)if(n[o]+t<56)return o;return s[0]||0}}var O=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bt(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var r=function n(){if(this instanceof n){var s=[null];s.push.apply(s,arguments);var o=Function.bind.apply(t,s);return new o}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var s=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return i[n]}})}),r}var Q={},Ot={get exports(){return Q},set exports(i){Q=i}};(function(i){(function(t,r,n){function s(e){var c=this,f=u();c.next=function(){var a=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=a-(c.c=a|0)},c.c=1,c.s0=f(" "),c.s1=f(" "),c.s2=f(" "),c.s0-=f(e),c.s0<0&&(c.s0+=1),c.s1-=f(e),c.s1<0&&(c.s1+=1),c.s2-=f(e),c.s2<0&&(c.s2+=1),f=null}function o(e,c){return c.c=e.c,c.s0=e.s0,c.s1=e.s1,c.s2=e.s2,c}function p(e,c){var f=new s(e),a=c&&c.state,l=f.next;return l.int32=function(){return f.next()*4294967296|0},l.double=function(){return l()+(l()*2097152|0)*11102230246251565e-32},l.quick=l,a&&(typeof a=="object"&&o(a,f),l.state=function(){return o(f,{})}),l}function u(){var e=4022871197,c=function(f){f=String(f);for(var a=0;a<f.length;a++){e+=f.charCodeAt(a);var l=.02519603282416938*e;e=l>>>0,l-=e,l*=e,e=l>>>0,l-=e,e+=l*4294967296}return(e>>>0)*23283064365386963e-26};return c}r&&r.exports?r.exports=p:n&&n.amd?n(function(){return p}):this.alea=p})(O,i,!1)})(Ot);var U={},zt={get exports(){return U},set exports(i){U=i}};(function(i){(function(t,r,n){function s(u){var e=this,c="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var a=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^a^a>>>8},u===(u|0)?e.x=u:c+=u;for(var f=0;f<c.length+64;f++)e.x^=c.charCodeAt(f)|0,e.next()}function o(u,e){return e.x=u.x,e.y=u.y,e.z=u.z,e.w=u.w,e}function p(u,e){var c=new s(u),f=e&&e.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},a.int32=c.next,a.quick=a,f&&(typeof f=="object"&&o(f,c),a.state=function(){return o(c,{})}),a}r&&r.exports?r.exports=p:n&&n.amd?n(function(){return p}):this.xor128=p})(O,i,!1)})(zt);var K={},Gt={get exports(){return K},set exports(i){K=i}};(function(i){(function(t,r,n){function s(u){var e=this,c="";e.next=function(){var a=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^(a^a<<1))|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,u===(u|0)?e.x=u:c+=u;for(var f=0;f<c.length+64;f++)e.x^=c.charCodeAt(f)|0,f==c.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function o(u,e){return e.x=u.x,e.y=u.y,e.z=u.z,e.w=u.w,e.v=u.v,e.d=u.d,e}function p(u,e){var c=new s(u),f=e&&e.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},a.int32=c.next,a.quick=a,f&&(typeof f=="object"&&o(f,c),a.state=function(){return o(c,{})}),a}r&&r.exports?r.exports=p:n&&n.amd?n(function(){return p}):this.xorwow=p})(O,i,!1)})(Gt);var Y={},Nt={get exports(){return Y},set exports(i){Y=i}};(function(i){(function(t,r,n){function s(u){var e=this;e.next=function(){var f=e.x,a=e.i,l,h;return l=f[a],l^=l>>>7,h=l^l<<24,l=f[a+1&7],h^=l^l>>>10,l=f[a+3&7],h^=l^l>>>3,l=f[a+4&7],h^=l^l<<7,l=f[a+7&7],l=l^l<<13,h^=l^l<<9,f[a]=h,e.i=a+1&7,h};function c(f,a){var l,h=[];if(a===(a|0))h[0]=a;else for(a=""+a,l=0;l<a.length;++l)h[l&7]=h[l&7]<<15^a.charCodeAt(l)+h[l+1&7]<<13;for(;h.length<8;)h.push(0);for(l=0;l<8&&h[l]===0;++l);for(l==8?h[7]=-1:h[l],f.x=h,f.i=0,l=256;l>0;--l)f.next()}c(e,u)}function o(u,e){return e.x=u.x.slice(),e.i=u.i,e}function p(u,e){u==null&&(u=+new Date);var c=new s(u),f=e&&e.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},a.int32=c.next,a.quick=a,f&&(f.x&&o(f,c),a.state=function(){return o(c,{})}),a}r&&r.exports?r.exports=p:n&&n.amd?n(function(){return p}):this.xorshift7=p})(O,i,!1)})(Nt);var J={},$t={get exports(){return J},set exports(i){J=i}};(function(i){(function(t,r,n){function s(u){var e=this;e.next=function(){var f=e.w,a=e.X,l=e.i,h,g;return e.w=f=f+1640531527|0,g=a[l+34&127],h=a[l=l+1&127],g^=g<<13,h^=h<<17,g^=g>>>15,h^=h>>>12,g=a[l]=g^h,e.i=l,g+(f^f>>>16)|0};function c(f,a){var l,h,g,v,_,x=[],k=128;for(a===(a|0)?(h=a,a=null):(a=a+"\0",h=0,k=Math.max(k,a.length)),g=0,v=-32;v<k;++v)a&&(h^=a.charCodeAt((v+32)%a.length)),v===0&&(_=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,v>=0&&(_=_+1640531527|0,l=x[v&127]^=h+_,g=l==0?g+1:0);for(g>=128&&(x[(a&&a.length||0)&127]=-1),g=127,v=4*128;v>0;--v)h=x[g+34&127],l=x[g=g+1&127],h^=h<<13,l^=l<<17,h^=h>>>15,l^=l>>>12,x[g]=h^l;f.w=_,f.X=x,f.i=g}c(e,u)}function o(u,e){return e.i=u.i,e.w=u.w,e.X=u.X.slice(),e}function p(u,e){u==null&&(u=+new Date);var c=new s(u),f=e&&e.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},a.int32=c.next,a.quick=a,f&&(f.X&&o(f,c),a.state=function(){return o(c,{})}),a}r&&r.exports?r.exports=p:n&&n.amd?n(function(){return p}):this.xor4096=p})(O,i,!1)})($t);var W={},Ft={get exports(){return W},set exports(i){W=i}};(function(i){(function(t,r,n){function s(u){var e=this,c="";e.next=function(){var a=e.b,l=e.c,h=e.d,g=e.a;return a=a<<25^a>>>7^l,l=l-h|0,h=h<<24^h>>>8^g,g=g-a|0,e.b=a=a<<20^a>>>12^l,e.c=l=l-h|0,e.d=h<<16^l>>>16^g,e.a=g-a|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,u===Math.floor(u)?(e.a=u/4294967296|0,e.b=u|0):c+=u;for(var f=0;f<c.length+20;f++)e.b^=c.charCodeAt(f)|0,e.next()}function o(u,e){return e.a=u.a,e.b=u.b,e.c=u.c,e.d=u.d,e}function p(u,e){var c=new s(u),f=e&&e.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var l=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(l+h)/(1<<21);while(g===0);return g},a.int32=c.next,a.quick=a,f&&(typeof f=="object"&&o(f,c),a.state=function(){return o(c,{})}),a}r&&r.exports?r.exports=p:n&&n.amd?n(function(){return p}):this.tychei=p})(O,i,!1)})(Ft);var Z={},Xt={get exports(){return Z},set exports(i){Z=i}};const Lt={},Rt=Object.freeze(Object.defineProperty({__proto__:null,default:Lt},Symbol.toStringTag,{value:"Module"})),Vt=Bt(Rt);(function(i){(function(t,r,n){var s=256,o=6,p=52,u="random",e=n.pow(s,o),c=n.pow(2,p),f=c*2,a=s-1,l;function h(w,b,I){var P=[];b=b==!0?{entropy:!0}:b||{};var M=x(_(b.entropy?[w,A(r)]:w??k(),3),P),q=new g(P),j=function(){for(var S=q.g(o),C=e,y=0;S<c;)S=(S+y)*s,C*=s,y=q.g(1);for(;S>=f;)S/=2,C/=2,y>>>=1;return(S+y)/C};return j.int32=function(){return q.g(4)|0},j.quick=function(){return q.g(4)/4294967296},j.double=j,x(A(q.S),r),(b.pass||I||function(S,C,y,m){return m&&(m.S&&v(m,q),S.state=function(){return v(q,{})}),y?(n[u]=S,C):S})(j,M,"global"in b?b.global:this==n,b.state)}function g(w){var b,I=w.length,P=this,M=0,q=P.i=P.j=0,j=P.S=[];for(I||(w=[I++]);M<s;)j[M]=M++;for(M=0;M<s;M++)j[M]=j[q=a&q+w[M%I]+(b=j[M])],j[q]=b;(P.g=function(S){for(var C,y=0,m=P.i,D=P.j,E=P.S;S--;)C=E[m=a&m+1],y=y*s+E[a&(E[m]=E[D=a&D+C])+(E[D]=C)];return P.i=m,P.j=D,y})(s)}function v(w,b){return b.i=w.i,b.j=w.j,b.S=w.S.slice(),b}function _(w,b){var I=[],P=typeof w,M;if(b&&P=="object")for(M in w)try{I.push(_(w[M],b-1))}catch{}return I.length?I:P=="string"?w:w+"\0"}function x(w,b){for(var I=w+"",P,M=0;M<I.length;)b[a&M]=a&(P^=b[a&M]*19)+I.charCodeAt(M++);return A(b)}function k(){try{var w;return l&&(w=l.randomBytes)?w=w(s):(w=new Uint8Array(s),(t.crypto||t.msCrypto).getRandomValues(w)),A(w)}catch{var b=t.navigator,I=b&&b.plugins;return[+new Date,t,I,t.screen,A(r)]}}function A(w){return String.fromCharCode.apply(0,w)}if(x(n.random(),r),i.exports){i.exports=h;try{l=Vt}catch{}}else n["seed"+u]=h})(typeof self<"u"?self:O,[],Math)})(Xt);var Ht=Q,Qt=U,Ut=K,Kt=Y,Yt=J,Jt=W,z=Z;z.alea=Ht;z.xor128=Qt;z.xorwow=Ut;z.xorshift7=Kt;z.xor4096=Yt;z.tychei=Jt;var Wt=z;function at(i,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,te(n.key),n)}}function nt(i,t,r){return t&&at(i.prototype,t),r&&at(i,r),Object.defineProperty(i,"prototype",{writable:!1}),i}function ht(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i,tt(i,t)}function tt(i,t){return tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},tt(i,t)}function Zt(i,t){if(typeof i!="object"||i===null)return i;var r=i[Symbol.toPrimitive];if(r!==void 0){var n=r.call(i,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(i)}function te(i){var t=Zt(i,"string");return typeof t=="symbol"?t:String(t)}var R=function(){function i(){}var t=i.prototype;return t._seed=function(n,s){if(n===(n||0))return n;for(var o=""+n,p=0,u=0;u<o.length;++u)p^=o.charCodeAt(u)|0;return p},i}(),ct=function(i){ht(t,i);function t(n,s){var o;return o=i.call(this)||this,o._rng=void 0,o.seed(n,s),o}var r=t.prototype;return r.next=function(){return this._rng()},r.seed=function(s,o){this._rng=s},r.clone=function(s,o){return new t(this._rng,o)},nt(t,[{key:"name",get:function(){return"function"}}]),t}(R),ut=function(){var i=[].slice.call(arguments),t=i,r=t[0],n=r===void 0?"default":r;switch(typeof n){case"object":if(n instanceof R)return n;break;case"function":return new ct(n);case"number":case"string":default:return new ct(Wt.apply(void 0,i))}throw new Error('invalid RNG "'+n+'"')},ee=function(i,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),function(){return i.next()*(r-t)+t}};function T(i){return new ne(i)}var ne=function(t){var r=this;this.n=void 0,this.isInt=function(){if(Number.isInteger(r.n))return r;throw new Error("Expected number to be an integer, got "+r.n)},this.isPositive=function(){if(r.n>0)return r;throw new Error("Expected number to be positive, got "+r.n)},this.lessThan=function(n){if(r.n<n)return r;throw new Error("Expected number to be less than "+n+", got "+r.n)},this.greaterThanOrEqual=function(n){if(r.n>=n)return r;throw new Error("Expected number to be greater than or equal to "+n+", got "+r.n)},this.greaterThan=function(n){if(r.n>n)return r;throw new Error("Expected number to be greater than "+n+", got "+r.n)},this.n=t},re=function(i,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),r===void 0&&(r=t===void 0?1:t,t=0),T(t).isInt(),T(r).isInt(),function(){return Math.floor(i.next()*(r-t+1)+t)}},ie=function(i){return function(){return i.next()>=.5}},oe=function(i,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),function(){var n,s,o;do n=i.next()*2-1,s=i.next()*2-1,o=n*n+s*s;while(!o||o>1);return t+r*s*Math.sqrt(-2*Math.log(o)/o)}},se=function(i,t,r){t===void 0&&(t=0),r===void 0&&(r=1);var n=i.normal(t,r);return function(){return Math.exp(n())}},ae=function(i,t){return t===void 0&&(t=.5),T(t).greaterThanOrEqual(0).lessThan(1),function(){return Math.floor(i.next()+t)}},ce=function(i,t,r){return t===void 0&&(t=1),r===void 0&&(r=.5),T(t).isInt().isPositive(),T(r).greaterThanOrEqual(0).lessThan(1),function(){for(var n=0,s=0;n++<t;)i.next()<r&&s++;return s}},ue=function(i,t){t===void 0&&(t=.5),T(t).greaterThan(0).lessThan(1);var r=1/Math.log(1-t);return function(){return Math.floor(1+Math.log(i.next())*r)}},le=[0,0,.6931471805599453,1.791759469228055,3.1780538303479458,4.787491742782046,6.579251212010101,8.525161361065415,10.60460290274525,12.801827480081469],fe=function(t){return le[t]},he=.9189385332046727,pe=function(i,t){if(t===void 0&&(t=1),T(t).isPositive(),t<10){var r=Math.exp(-t);return function(){for(var e=r,c=0,f=i.next();f>e;)f=f-e,e=t*e/++c;return c}}else{var n=Math.sqrt(t),s=.931+2.53*n,o=-.059+.02483*s,p=1.1239+1.1328/(s-3.4),u=.9277-3.6224/(s-2);return function(){for(;;){var e=void 0,c=i.next();if(c<=.86*u)return e=c/u-.43,Math.floor((2*o/(.5-Math.abs(e))+s)*e+t+.445);c>=u?e=i.next()-.5:(e=c/u-.93,e=(e<0?-.5:.5)-e,c=i.next()*u);var f=.5-Math.abs(e);if(!(f<.013&&c>f)){var a=Math.floor((2*o/f+s)*e+t+.445);if(c=c*p/(o/(f*f)+s),a>=10){var l=(a+.5)*Math.log(t/a)-t-he+a-(.08333333333333333-(.002777777777777778-1/(1260*a*a))/(a*a))/a;if(Math.log(c*n)<=l)return a}else if(a>=0){var h,g=(h=fe(a))!=null?h:0;if(Math.log(c)<=a*Math.log(t)-t-g)return a}}}}}},ve=function(i,t){return t===void 0&&(t=1),T(t).isPositive(),function(){return-Math.log(1-i.next())/t}},ge=function(i,t){return t===void 0&&(t=1),T(t).isInt().greaterThanOrEqual(0),function(){for(var r=0,n=0;n<t;++n)r+=i.next();return r}},de=function(i,t){t===void 0&&(t=1),T(t).isInt().isPositive();var r=i.irwinHall(t);return function(){return r()/t}},we=function(i,t){t===void 0&&(t=1),T(t).greaterThanOrEqual(0);var r=1/t;return function(){return 1/Math.pow(1-i.next(),r)}},xe=function(i){ht(t,i);function t(){return i.apply(this,arguments)||this}var r=t.prototype;return r.next=function(){return Math.random()},r.seed=function(s,o){},r.clone=function(){return new t},nt(t,[{key:"name",get:function(){return"default"}}]),t}(R),pt=function(){function i(r){var n=this;this._rng=void 0,this._patch=void 0,this._cache={},this.next=function(){return n._rng.next()},this.float=function(s,o){return n.uniform(s,o)()},this.int=function(s,o){return n.uniformInt(s,o)()},this.integer=function(s,o){return n.uniformInt(s,o)()},this.bool=function(){return n.uniformBoolean()()},this.boolean=function(){return n.uniformBoolean()()},this.uniform=function(s,o){return n._memoize("uniform",ee,s,o)},this.uniformInt=function(s,o){return n._memoize("uniformInt",re,s,o)},this.uniformBoolean=function(){return n._memoize("uniformBoolean",ie)},this.normal=function(s,o){return oe(n,s,o)},this.logNormal=function(s,o){return se(n,s,o)},this.bernoulli=function(s){return ae(n,s)},this.binomial=function(s,o){return ce(n,s,o)},this.geometric=function(s){return ue(n,s)},this.poisson=function(s){return pe(n,s)},this.exponential=function(s){return ve(n,s)},this.irwinHall=function(s){return ge(n,s)},this.bates=function(s){return de(n,s)},this.pareto=function(s){return we(n,s)},r&&r instanceof R?this.use(r):this.use(new xe),this._cache={}}var t=i.prototype;return t.clone=function(){var n=[].slice.call(arguments);return n.length?new i(ut.apply(void 0,n)):new i(this.rng.clone())},t.use=function(){this._rng=ut.apply(void 0,[].slice.call(arguments))},t.patch=function(){if(this._patch)throw new Error("Math.random already patched");this._patch=Math.random,Math.random=this.uniform()},t.unpatch=function(){this._patch&&(Math.random=this._patch,delete this._patch)},t.choice=function(n){if(!Array.isArray(n))throw new Error("Random.choice expected input to be an array, got "+typeof n);var s=n==null?void 0:n.length;if(s>0){var o=this.uniformInt(0,s-1)();return n[o]}else return},t._memoize=function(n,s){var o=[].slice.call(arguments,2),p=""+o.join(";"),u=this._cache[n];return(u===void 0||u.key!==p)&&(u={key:p,distribution:s.apply(void 0,[this].concat(o))},this._cache[n]=u),u.distribution},nt(i,[{key:"rng",get:function(){return this._rng}}]),i}();new pt;class me{constructor(){d(this,"res");this.res=null}async enter(){return this.res?(await new Promise(t=>{var r;(r=this.res)==null||r.push(t)}),!1):(this.res=[],!0)}leave(){this.res&&(this.res.length>0?this.res.shift()():this.res=null)}}class rt{constructor(){d(this,"section");d(this,"items");d(this,"resolves");this.section=new me,this.items=[],this.resolves=[]}push(t,r=!0){const n=this.resolves.shift();n?this.section.enter().then(s=>{s&&r?setTimeout(()=>{n(t),this.section.leave()},0):(n(t),this.section.leave())}):this.items.push(t)}async pop(){return this.items.length>0?this.items.shift():new Promise(t=>{this.resolves.push(t)})}}class N{constructor(){d(this,"slots");this.slots=[]}connect(t){this.slots.push(t)}disconnect(t){t?this.slots=this.slots.filter(r=>r===t):this.slots=[]}async emit(t,r=!1){if(r)await Promise.all(this.slots.map(n=>n.exec(t)));else for(const n of this.slots)await n.exec(t)}}class ${constructor(){d(this,"action");this.action=[]}async exec(t){for(const r of this.action)await r(t)}bind(t){this.action.push(t)}}class vt{constructor(t=!1){d(this,"signal");d(this,"slot");this.signal=new N,this.slot=new $,this.slot.bind(async r=>{await this.signal.emit(r,t)})}}class ye{constructor(t){d(this,"game");this.game=t}async exec(t){for(;!t();){const r=await this.game.queue.pop();await this.game.game.mainBroadcast.slot.exec(r)}}}class be{constructor(t){d(this,"game");d(this,"loop");d(this,"queue");d(this,"mainSlot");d(this,"clientBroadcast");this.game=t(this),this.loop=new ye(this),this.queue=new rt,this.mainSlot=new $,this.mainSlot.bind(async r=>{this.queue.push(r)}),this.clientBroadcast=new vt}async poll(t=()=>!1){await this.loop.exec(t)}bind(t){const r=t(this);return this.game.clientSignal.connect(r.clientSlot),r.clientSignal.connect(this.clientBroadcast.slot),r}getClientConnection(){return{signal:this.clientBroadcast.signal,slot:this.mainSlot}}}class _e{constructor(t){d(this,"connections");d(this,"queue");const r=new $;r.bind(async n=>{this.queue.push(n)}),this.connections=t,this.queue=new rt,t.forEach(n=>{n.signal.connect(r)})}async poll(t=()=>!1){const r=new N;for(this.connections.forEach(n=>{r.connect(n.slot)});!t();){const n=await this.queue.pop();await r.emit(n,!0)}}}class H{constructor(t,r){d(this,"slave");d(this,"clientSignal");d(this,"clientSlot");d(this,"ai");d(this,"ID");this.slave=t,this.clientSignal=new N,this.clientSlot=new $,this.ai=r,this.ID=0,this.clientSlot.bind(async n=>{if(this.ID===n.player&&n.msg==="start"){const s=this.slave,o=await this.ai.eval(s.game.data.roll,p=>{const u=(p+this.ID)%4;return s.game.data.chess[u]});await this.clientSignal.emit(o)}})}}class Se{constructor(t){d(this,"slave");d(this,"clientSignal");d(this,"clientSlot");d(this,"ID");d(this,"resolve");d(this,"data");this.slave=t,this.clientSignal=new N,this.clientSlot=new $,this.ID=0,this.resolve=null,this.data=et({current:G(()=>this.slave.game.data.current),input:G(()=>this.ID===this.slave.game.data.current),roll:G(()=>this.slave.game.data.roll)}),this.clientSlot.bind(async r=>{if(r.msg==="start"&&this.data.input){const n=[];for(let s=0;s<4;s++){const o=this.slave.game.data.chess[0][s];o!==56&&(o===-1?this.data.roll===6&&n.push(s):n.push(s))}if(n.length===0)setTimeout(()=>{this.clientSignal.emit(0)},0);else if(n.length===1)setTimeout(()=>{this.clientSignal.emit(n[0])},0);else{const s=await new Promise(o=>{this.resolve=o});await this.clientSignal.emit(s)}}})}choose(t){if(this.resolve){const r=this.resolve;this.resolve=null,r(t)}}}class Pe{constructor(t,r){d(this,"slave");d(this,"mainBroadcast");d(this,"clientSignal");d(this,"gen");d(this,"data");d(this,"queue");d(this,"clients");this.slave=r,this.mainBroadcast=new vt,this.clientSignal=new N,this.mainBroadcast.slot.bind(async n=>{this.queue.push(n)}),this.gen=new pt,this.gen.use(t),this.data=et({chess:{0:{0:-1,1:-1,2:-1,3:-1},1:{0:-1,1:-1,2:-1,3:-1},2:{0:-1,1:-1,2:-1,3:-1},3:{0:-1,1:-1,2:-1,3:-1}},current:0,fin:{0:!1,1:!1,2:!1,3:!1},roll:1,animation:G(()=>!this.data.fin[0])}),this.queue=new rt,this.clients=Array.from({length:4},()=>null)}remap(t,r){if(r<=0||r>=51)return-1;const n=(t+4-this.data.current)%4;return r+13*n<=50?r+13*n:r>13*(4-n)?r-13*(4-n):-1}async play(){for(;;){if(this.data.fin[this.data.current]){this.data.current=(this.data.current+1)%4;let u=!0;for(let e=0;e<4;e++)this.data.fin[e]||(u=!1);if(u)return 0;continue}const t=this.gen.int(1,6);this.data.roll=t,await this.clientSignal.emit({msg:"start",player:this.data.current});const r=await this.queue.pop(),n=[];for(let u=0;u<4;u++){const e=this.data.chess[this.data.current][u];e!==56&&(e!==-1||t===6)&&n.push(u)}if(n.length===0){await this.clientSignal.emit({msg:"end",player:this.data.current}),this.data.current=(this.data.current+1)%4;continue}else if(!n.includes(r))continue;const s=this.data.chess[this.data.current][r],o=[];if(s===-1)t===6&&o.push(0);else if(s+t===56)o.push(56);else if(s+t>56)o.push(56),o.push(56-(s+t-56));else if(s+t>=50)o.push(s+t);else{let u=s+t,e=!1;if(o.push(u),u===18&&(e=!0,u=30,o.push(u)),u%4===2&&(u+=4,o.push(u)),u===18&&(e=!0,u=30,o.push(u)),e){const c=this.data.current^2;for(let f=0;f<4;f++)this.data.chess[c][f]===53&&(this.data.chess[c][f]=-1)}}for(const u of o){this.data.chess[this.data.current][r]=u;for(let e=0;e<4;e++)if(e!==this.data.current)for(let c=0;c<4;c++)this.remap(e,this.data.chess[e][c])===u&&(this.data.chess[e][c]=-1);await new Promise(e=>setTimeout(e,0))}let p=!0;for(let u=0;u<4;u++)this.data.chess[this.data.current][u]!==56&&(p=!1);p&&(this.data.fin[this.data.current]=!0),await this.clientSignal.emit({msg:"end",player:this.data.current}),(t!==6||p)&&(this.data.current=(this.data.current+1)%4)}}}class Me{constructor(t,r){d(this,"games");this.games=[];const n=[];for(let o=0;o<4;o++){const p=new be(e=>{const c=new Pe(t,e);return this.games.push(c),c});n.push(p.getClientConnection());const u=p.bind(r[o]);u.ID=o,p.game.clients[o]=u,p.poll()}new _e(n).poll()}start(){this.games.forEach(t=>t.play())}}const qe=lt({__name:"GameView",setup(i){const t=kt(),r=Et(),n=new Me(r.query.seed,[o=>new Se(o),o=>new H(o,new V),o=>new H(o,new V),o=>new H(o,new V)]);n.start();function s(){t.push({name:"config"})}return(o,p)=>(ft(),Mt(qt,{class:"ma-1 d-flex flex-column"},{default:X(()=>[L(Ct,null,{default:X(()=>[L(jt,{color:"red",onClick:p[0]||(p[0]=u=>s())},{default:X(()=>[ot("返回")]),_:1})]),_:1}),L(Tt,null,{default:X(()=>[ot(" 当前种子: "+It(st(r).query.seed),1)]),_:1}),L(Dt,{client:st(n).games[0].clients[0]},null,8,["client"])]),_:1}))}});export{qe as default};
