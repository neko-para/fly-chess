(function(){var t={8363:function(t,e,i){"use strict";var n=i(9242),s=i(3396),r=i(4870),a=(i(7658),i(7139));const l={width:"360",height:"360","view-box":"0 0 360 360"},o=(0,s._)("rect",{x:"0",y:"0",width:"360",height:"360",fill:"wheat"},null,-1),c=(0,s.uE)('<g id="rectItem"><rect x="-20" y="-10" width="40" height="20" stroke="black"></rect></g><g id="triItem"><path d="M 0 0 L 40 0 L 0 40 z" stroke="black"></path></g><g id="squareItem"><rect x="-10" y="-10" width="20" height="20" stroke="black"></rect></g><g id="arrowItem"><path d="M -2 -10 L 2 -10 L 2 0 L 4 0 L 0 10 L -4 0 L -2 0 z"></path></g><g id="chess"><circle r="8" fill="white" stroke="black"></circle><circle r="5"></circle></g>',5),h={id:"partofBoard","stroke-linejoin":"round"},u=["xlink:href","transform"],f=(0,s.uE)('<circle cx="15" cy="105" r="8" fill="white" stroke="black"></circle><rect x="20" y="20" width="60" height="60"></rect><circle cx="40" cy="40" r="8" fill="white" stroke="black"></circle><circle cx="40" cy="60" r="8" fill="white" stroke="black"></circle><circle cx="60" cy="40" r="8" fill="white" stroke="black"></circle><circle cx="60" cy="60" r="8" fill="white" stroke="black"></circle><path d="M 150 150 L 180 180 L 150 210 z" stroke="black"></path><use xlink:href="#arrowItem" transform="translate(260, 150)" stroke="black"></use><use xlink:href="#arrowItem" transform="translate(260, 210)" stroke="black"></use>',9),d=["fill","stroke","transform"],v=["fill","stroke","transform","onClick"],w=["x","y"];var g=(0,s.aZ)({__name:"ChessBoard",props:{client:null},setup(t){const e=t,i=[[0,1,60,110],[0,0,110,80],[0,1,160,30],[0,0,330,140],[0,0,330,220],[0,1,160,330],[0,0,110,280],[0,1,60,250],[0,0,30,180],[1,3,230,50],[1,2,270,130],[1,1,270,230],[1,0,230,310],[2,0,60,180],[2,0,80,180],[2,0,100,180],[2,0,120,180],[2,0,140,180]],n=[[40,40],[40,60],[60,40],[60,60]],g=[[15,105],[38,118],[60,110],[80,110],[102,118],[118,102],[110,80],[110,60],[118,38],[140,30],[160,30],[180,30],[200,30],[220,30],[242,38],[250,60],[250,80],[242,102],[258,118],[280,110],[300,110],[322,118],[330,140],[330,160],[330,180],[330,200],[330,220],[322,242],[300,250],[280,250],[258,242],[242,258],[250,280],[250,300],[242,322],[220,330],[200,330],[180,330],[160,330],[140,330],[118,322],[110,300],[110,280],[118,258],[102,242],[80,250],[60,250],[38,242],[30,220],[30,200],[30,180],[60,180],[80,180],[100,180],[120,180],[140,180],[160,180]],m=["#rectItem","#triItem","#squareItem"],p=["#FF3F3F","#CFCF00","#00CFFF","#00CF00"];function k(t,e){const[i,n]=e;switch(t){case 0:return[i,n];case 1:return[360-n,i];case 2:return[360-i,360-n];case 3:return[n,360-i]}}const y=(0,s.Fl)((()=>{const t=[],i=new Set;for(let s=0;s<4;s++)for(let r=0;r<4;r++){const a=e.client.slave.game.data.chess[s][r];let[l,o]=k(s,a>=0?g[a]:n[r]);while(i.has(`${l}${o}`))l+=2,o-=2;i.add(`${l}${o}`),t.push([l,o,p[s],s,r,a])}return t}));function b(t){const[i,n,s,r,a,l]=y.value[t];0===r&&e.client.choose(a)}return(e,n)=>((0,s.wg)(),(0,s.iD)("svg",l,[o,(0,s._)("defs",null,[c,(0,s._)("g",h,[((0,s.wg)(),(0,s.iD)(s.HY,null,(0,s.Ko)(i,((t,e)=>(0,s._)("use",{key:`board-item-${e}`,"xlink:href":m[t[0]],transform:`translate(${t[2]}, ${t[3]}) rotate(${90*t[1]})`},null,8,u))),64)),f])]),((0,s.wg)(),(0,s.iD)(s.HY,null,(0,s.Ko)(p,((e,i)=>(0,s._)("use",{key:`board-${i}`,"xlink:href":"#partofBoard",fill:e,stroke:t.client.slave?.game.data.current===i?"yellow":"black",transform:`translate(180, 180) rotate(${90*i}) translate(-180, -180)`},null,8,d))),64)),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)((0,r.SU)(y),((t,e)=>((0,s.wg)(),(0,s.iD)("use",{key:`chess-${e}`,"xlink:href":"#chess",fill:t[2],stroke:t[2],transform:`translate(${t[0]}, ${t[1]})`,style:{transition:"all 0.2s"},onClick:t=>b(e)},null,8,v)))),128)),(0,s._)("text",{x:[0,3].includes(t.client.data.current)?5:343,y:t.client.data.current<2?20:356,"font-family":"consolas","font-size":"20"},(0,a.zw)(t.client.data.roll),9,w)]))}});const m=g;var p=m;class k{async eval(t,e){const i=e(0);if(6===t)for(let s=0;s<4;s++)if(-1===i[s])return s;const n=[];for(let s=0;s<4;s++){const t=i[s];56!==t&&-1!==t&&n.push(s)}for(const s of n)if(i[s]+t===56)return s;for(const s of n)if(i[s]+t===14||i[s]+t===18)return s;for(const s of n)if(i[s]+t<=46&&(i[s]+t)%4===2)return s;for(const s of n)if(i[s]+t<56)return s;return n[0]||0}}var y=i(7327),b=i(5028),x=i(3415);class Z{constructor(t){(0,y.Z)(this,"slave",void 0),(0,y.Z)(this,"clientSignal",void 0),(0,y.Z)(this,"clientSlot",void 0),(0,y.Z)(this,"ai",void 0),(0,y.Z)(this,"ID",void 0),this.slave=null,this.clientSignal=new x.MZ,this.clientSlot=new x.g7,this.ai=t,this.ID=0,this.clientSlot.bind((async t=>{if(this.ID===t){const t=this.slave,e=await this.ai.eval(t.game.data.roll,(e=>{const i=(e+this.ID)%4;return t.game.data.chess[i]}));await this.clientSignal.emit(e)}}))}}class S{constructor(){(0,y.Z)(this,"slave",void 0),(0,y.Z)(this,"clientSignal",void 0),(0,y.Z)(this,"clientSlot",void 0),(0,y.Z)(this,"ID",void 0),(0,y.Z)(this,"resolve",void 0),(0,y.Z)(this,"data",void 0),this.slave=null,this.clientSignal=new x.MZ,this.clientSlot=new x.g7,this.ID=0,this.resolve=null,this.data=(0,r.qj)({current:(0,s.Fl)((()=>this.slave?this.slave.game.data.current:0)),input:(0,s.Fl)((()=>this.ID===this.slave?.game.data.current)),roll:(0,s.Fl)((()=>this.slave?this.slave.game.data.roll:-1))}),this.clientSlot.bind((async()=>{if(this.data.input){let t=!0,e=-1;for(let i=0;i<4;i++){const n=this.slave?.game.data.chess[0][i]||0;[-1,56].includes(n)||(t=!1,-1===n&&-1===e&&(e=i))}if(t&&6!==this.slave?.game.data.roll)setTimeout((()=>{this.clientSignal.emit(e)}));else{const t=await new Promise((t=>{this.resolve=t}));await this.clientSignal.emit(t)}}}))}choose(t){if(this.resolve){const e=this.resolve;this.resolve=null,e(t)}}}class I{constructor(t,e){(0,y.Z)(this,"slave",void 0),(0,y.Z)(this,"mainBroadcast",void 0),(0,y.Z)(this,"clientSignal",void 0),(0,y.Z)(this,"gen",void 0),(0,y.Z)(this,"data",void 0),(0,y.Z)(this,"queue",void 0),(0,y.Z)(this,"clients",void 0),this.slave=e,this.mainBroadcast=new x.zv,this.clientSignal=new x.MZ,this.mainBroadcast.slot.bind((async t=>{this.queue.push(t)})),this.gen=new b.kk,this.gen.use(t),this.data=(0,r.qj)({chess:{0:{0:-1,1:-1,2:-1,3:-1},1:{0:-1,1:-1,2:-1,3:-1},2:{0:-1,1:-1,2:-1,3:-1},3:{0:-1,1:-1,2:-1,3:-1}},current:0,fin:{0:!1,1:!1,2:!1,3:!1},roll:1,animation:(0,s.Fl)((()=>!this.data.fin[0]))}),this.queue=new x.zi,this.clients=Array.from({length:4},(()=>null))}remap(t,e){if(e<=0||e>=51)return-1;const i=(t+4-this.data.current)%4;return e+13*i<=50?e+13*i:e>13*(4-i)?e-13*(4-i):-1}async play(){for(;;){if(this.data.fin[this.data.current]){this.data.current=(this.data.current+1)%4;let t=!0;for(let e=0;e<4;e++)this.data.fin[e]||(t=!1);if(t)return 0;continue}this.data.animation&&await new Promise((t=>{setTimeout(t,100)}));const t=this.gen.int(1,6);this.data.roll=t,await this.clientSignal.emit(this.data.current);const e=await this.queue.pop(),i=this.data.chess[this.data.current][e];if(56===i)continue;const n=[];if(-1===i)6===t&&n.push(0);else if(i+t===56)n.push(56);else if(i+t>56)n.push(56),n.push(56-(i+t-56));else if(i+t>=50)n.push(i+t);else{let e=i+t,s=!1;if(n.push(e),18===e&&(s=!0,e=30,n.push(e)),e%4===2&&(e+=4,n.push(e)),18===e&&(s=!0,e=30,n.push(e)),s){const t=2^this.data.current;for(let e=0;e<4;e++)53===this.data.chess[t][e]&&(this.data.chess[t][e]=-1)}}for(const r of n){this.data.chess[this.data.current][e]=r;for(let t=0;t<4;t++)if(t!==this.data.current)for(let e=0;e<4;e++){const i=this.remap(t,this.data.chess[t][e]);i===r&&(this.data.chess[t][e]=-1)}this.data.animation&&await new Promise((t=>{setTimeout(t,500)}))}let s=!0;for(let r=0;r<4;r++)56!==this.data.chess[this.data.current][r]&&(s=!1);s&&(this.data.fin[this.data.current]=!0),(6!==t||s)&&(this.data.current=(this.data.current+1)%4)}}}class F{constructor(t,e){(0,y.Z)(this,"games",void 0),this.games=[];const i=[];for(let s=0;s<4;s++){const n=new x.Ll((e=>{const i=new I(t,e);return this.games.push(i),i}));i.push(n.getClientConnection()),e[s].ID=s,n.game.clients[s]=e[s],n.bind(e[s]),n.poll()}const n=new x.Oi(i);n.poll()}start(){this.games.forEach((t=>t.play()))}}var D=(0,s.aZ)({__name:"App",setup(t){const e=Math.random().toString(),i=new F(e,[new S,new Z(new k),new Z(new k),new Z(new k)]);async function n(){for(let t=0;t<1e4;t++);}return i.start(),n(),(t,e)=>((0,s.wg)(),(0,s.j4)(p,{client:(0,r.SU)(i).games[0].clients[0]},null,8,["client"]))}});const _=D;var O=_;(0,n.ri)(O).mount("#app")},5042:function(){}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}i.m=t,function(){i.amdD=function(){throw new Error("define cannot be used indirect")}}(),function(){i.amdO={}}(),function(){var t=[];i.O=function(e,n,s,r){if(!n){var a=1/0;for(h=0;h<t.length;h++){n=t[h][0],s=t[h][1],r=t[h][2];for(var l=!0,o=0;o<n.length;o++)(!1&r||a>=r)&&Object.keys(i.O).every((function(t){return i.O[t](n[o])}))?n.splice(o--,1):(l=!1,r<a&&(a=r));if(l){t.splice(h--,1);var c=s();void 0!==c&&(e=c)}}return e}r=r||0;for(var h=t.length;h>0&&t[h-1][2]>r;h--)t[h]=t[h-1];t[h]=[n,s,r]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,n){var s,r,a=n[0],l=n[1],o=n[2],c=0;if(a.some((function(e){return 0!==t[e]}))){for(s in l)i.o(l,s)&&(i.m[s]=l[s]);if(o)var h=o(i)}for(e&&e(n);c<a.length;c++)r=a[c],i.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return i.O(h)},n=self["webpackChunkfly_chess"]=self["webpackChunkfly_chess"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(8363)}));n=i.O(n)})();
//# sourceMappingURL=app.4966c026.js.map